{"version":3,"sources":["../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"sourcesContent":["import * as React from 'react';\nimport { hasMouse as _hasPointer } from '@vkontakte/vkjs';\nimport { BridgeAdaptivity, useBridgeAdaptivity } from '../../hooks/useBridgeAdaptivity';\nimport {\n  BREAKPOINTS,\n  getSizeX,\n  isCompactByViewHeight,\n  isCompactByViewWidth,\n  SizeType,\n  ViewHeight,\n  ViewWidth,\n} from '../../lib/adaptivity';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { HasChildren } from '../../types';\nimport { AdaptivityContext, type AdaptivityProps } from './AdaptivityContext';\n\nconst warn = warnOnce('AdaptivityProvider');\n\nexport interface AdaptivityProviderProps extends AdaptivityProps, HasChildren {}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AdaptivityProvider\n */\nexport const AdaptivityProvider = ({\n  viewWidth,\n  viewHeight,\n  sizeX,\n  sizeY,\n  hasPointer,\n  hasHover,\n  children,\n}: AdaptivityProviderProps) => {\n  // TODO [>=6]: удалить использование хука (#5049)\n  /* eslint-disable @typescript-eslint/naming-convention */\n  const LEGACY_isPerhapsPropsByBridgeTypeAdaptive =\n    viewWidth !== undefined && viewHeight !== undefined;\n  const LEGACY_isPerhapsPropsByBridgeTypeForceMobile =\n    viewWidth !== undefined && sizeX !== undefined && sizeY !== undefined;\n  const LEGACY_disableInternalUseBridgeAdaptivity =\n    LEGACY_isPerhapsPropsByBridgeTypeAdaptive || LEGACY_isPerhapsPropsByBridgeTypeForceMobile;\n  const LEGACY_bridge = useBridgeAdaptivity(LEGACY_disableInternalUseBridgeAdaptivity);\n  /* eslint-enable @typescript-eslint/naming-convention */\n\n  if (process.env.NODE_ENV === 'development') {\n    // TODO [>=6]: удалить warn\n    if (!LEGACY_disableInternalUseBridgeAdaptivity) {\n      warn(\"[@vkontakte/vk-bridge] Интеграция VKUI с @vkontakte/vk-bridge устарела и будет удалена в v6. Используйте хук `useAdaptivity()` из @vkontakte/vk-bridge-react и результат передайте в компонент (см. https://github.com/VKCOM/VKUI/issues/5049)\"); // prettier-ignore\n    }\n  }\n\n  const adaptivity = React.useMemo(\n    () =>\n      calculateAdaptivity(\n        {\n          viewWidth,\n          viewHeight,\n          sizeX,\n          sizeY,\n          hasPointer,\n          hasHover,\n        },\n        LEGACY_bridge,\n      ),\n    [viewWidth, viewHeight, sizeX, sizeY, hasPointer, hasHover, LEGACY_bridge],\n  );\n\n  return <AdaptivityContext.Provider value={adaptivity}>{children}</AdaptivityContext.Provider>;\n};\n\nfunction calculateAdaptivity(\n  { viewWidth, viewHeight, sizeX, sizeY, hasPointer, hasHover }: AdaptivityProps,\n  LEGACY_bridge: BridgeAdaptivity, // eslint-disable-line @typescript-eslint/naming-convention\n) {\n  // TODO [>=6]: удалить блок кода c использованием LEGACY_bridge (#5049)\n  //  https://github.com/VKCOM/VKUI/blob/v5.5.5/packages/vkui/src/components/AdaptivityProvider/AdaptivityProvider.tsx#L46-L92\n  if (LEGACY_bridge.type === 'adaptive') {\n    const { viewportWidth, viewportHeight } = LEGACY_bridge;\n\n    if (viewportWidth >= BREAKPOINTS.DESKTOP) {\n      viewWidth = ViewWidth.DESKTOP;\n    } else if (viewportWidth >= BREAKPOINTS.TABLET) {\n      viewWidth = ViewWidth.TABLET;\n    } else if (viewportWidth >= BREAKPOINTS.SMALL_TABLET) {\n      viewWidth = ViewWidth.SMALL_TABLET;\n    } else if (viewportWidth >= BREAKPOINTS.MOBILE) {\n      viewWidth = ViewWidth.MOBILE;\n    } else {\n      viewWidth = ViewWidth.SMALL_MOBILE;\n    }\n\n    if (viewportHeight >= BREAKPOINTS.MEDIUM_HEIGHT) {\n      viewHeight = ViewHeight.MEDIUM;\n    } else if (viewportHeight >= BREAKPOINTS.MOBILE_LANDSCAPE_HEIGHT) {\n      viewHeight = ViewHeight.SMALL;\n    } else {\n      viewHeight = ViewHeight.EXTRA_SMALL;\n    }\n\n    if (viewWidth <= ViewWidth.MOBILE) {\n      sizeX = SizeType.COMPACT;\n    } else {\n      sizeX = SizeType.REGULAR;\n    }\n\n    if (\n      (viewWidth >= ViewWidth.SMALL_TABLET && _hasPointer) ||\n      viewHeight <= ViewHeight.EXTRA_SMALL\n    ) {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  } else if (\n    LEGACY_bridge.type === 'force_mobile' ||\n    LEGACY_bridge.type === 'force_mobile_compact'\n  ) {\n    viewWidth = ViewWidth.MOBILE;\n    sizeX = SizeType.COMPACT;\n\n    if (LEGACY_bridge.type === 'force_mobile_compact') {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  } else {\n    if (sizeX === undefined && viewWidth !== undefined) {\n      sizeX = getSizeX(viewWidth);\n    }\n\n    if (sizeY === undefined) {\n      if (isCompactByViewWidth(viewWidth, hasPointer) || isCompactByViewHeight(viewHeight)) {\n        sizeY = SizeType.COMPACT;\n      } else if (viewWidth !== undefined || viewHeight !== undefined) {\n        sizeY = SizeType.REGULAR;\n      }\n    }\n  }\n\n  return {\n    viewWidth,\n    viewHeight,\n    sizeX,\n    sizeY,\n    hasPointer,\n    hasHover,\n  };\n}\n"],"names":["React","hasMouse","_hasPointer","useBridgeAdaptivity","BREAKPOINTS","getSizeX","isCompactByViewHeight","isCompactByViewWidth","SizeType","ViewHeight","ViewWidth","warnOnce","AdaptivityContext","warn","AdaptivityProvider","viewWidth","viewHeight","sizeX","sizeY","hasPointer","hasHover","children","LEGACY_isPerhapsPropsByBridgeTypeAdaptive","undefined","LEGACY_isPerhapsPropsByBridgeTypeForceMobile","LEGACY_disableInternalUseBridgeAdaptivity","LEGACY_bridge","process","env","NODE_ENV","adaptivity","useMemo","calculateAdaptivity","Provider","value","type","viewportWidth","viewportHeight","DESKTOP","TABLET","SMALL_TABLET","MOBILE","SMALL_MOBILE","MEDIUM_HEIGHT","MEDIUM","MOBILE_LANDSCAPE_HEIGHT","SMALL","EXTRA_SMALL","COMPACT","REGULAR"],"mappings":"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"}