{"version":3,"sources":["../../../src/components/ConfigProvider/ConfigProvider.tsx"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { generateVKUITokensClassName } from '../../helpers/generateVKUITokensClassName';\nimport { useAutoDetectAppearance } from '../../hooks/useAutoDetectAppearance';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { useDOM } from '../../lib/dom';\nimport { TokensClassProvider } from '../../lib/tokensClassProvider';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport {\n  addClassNameToElement,\n  excludeKeysWithUndefined,\n  removeClassNameFromElement,\n} from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  useConfigProvider,\n  WebviewType,\n} from './ConfigProviderContext';\n\nconst warn = warnOnce('ConfigProvider');\n\nexport interface ConfigProviderProps extends Partial<ConfigProviderContextInterface> {\n  /**\n   * > ⚠️ В **v6** метод будет удалён (см. https://github.com/VKCOM/VKUI/issues/5049).\n   * > Используйте хук `useAppearance()` из библиотеки `@vkontakte/vk-bridge-react`, если вам нужно\n   * > определять, что `appearance` был передан через VK Bridge.\n   *\n   * @deprecated v5.8.0\n   */\n  onDetectAppearanceByBridge?: () => void; // TODO [>=6]: удалить\n  children: React.ReactNode;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ConfigProvider\n */\nexport const ConfigProvider = (propsRaw: ConfigProviderProps) => {\n  const props = excludeKeysWithUndefined(propsRaw);\n  const parentConfig = useConfigProvider();\n\n  const {\n    children,\n    webviewType,\n    hasCustomPanelHeaderAfter: hasCustomPanelHeaderAfterMerged,\n    customPanelHeaderAfterMinWidth,\n    isWebView,\n    transitionMotionEnabled,\n    platform,\n    locale,\n    appearance: appearanceProp,\n    onDetectAppearanceByBridge = noop,\n  } = {\n    ...parentConfig,\n    ...props,\n  };\n\n  // TODO [>=6]: Удалить данный бэкпорт\n  const hasCustomPanelHeaderAfter =\n    props.webviewType && props.hasCustomPanelHeaderAfter === undefined\n      ? props.webviewType === WebviewType.VKAPPS\n      : hasCustomPanelHeaderAfterMerged;\n\n  if (process.env.NODE_ENV === 'development') {\n    // TODO [>=6]: удалить warn\n    let webviewTypeRule = '';\n    if (props.webviewType) {\n      webviewTypeRule =\n        props.webviewType === WebviewType.INTERNAL\n          ? '3. замените webviewType={WebviewType.INTERNAL} на hasCustomPanelHeaderAfterProp={false}'\n          : '3. замените webviewType={WebviewType.VKAPPS} на hasCustomPanelHeaderAfterProp={true}';\n    }\n    warn(`[@vkontakte/vk-bridge's deprecated] Если вы используете VK Bridge, то:\n\n1. используйте хук useAppearance() из @vkontakte/vk-bridge-react и результат передайте в параметр appearance;\n2. передайте bridge.isWebView() в параметр isWebView;\n${webviewTypeRule}\n\nПодробности см. https://github.com/VKCOM/VKUI/issues/5049\n`);\n  }\n\n  // TODO [>=6]: удалить использование хука\n  const appearance = useAutoDetectAppearance(appearanceProp, onDetectAppearanceByBridge);\n\n  const { document } = useDOM();\n\n  // TODO [>=6]: переместить хук в AppRoot (см. https://github.com/VKCOM/VKUI/issues/4810).\n  useIsomorphicLayoutEffect(\n    function attachVKUITokensClassNameToBody() {\n      if (!document) {\n        return;\n      }\n\n      const VKUITokensClassName = generateVKUITokensClassName(platform, appearance);\n\n      addClassNameToElement(document.body, VKUITokensClassName);\n      return () => {\n        removeClassNameFromElement(document.body, VKUITokensClassName);\n      };\n    },\n    [platform, appearance],\n  );\n\n  const configContext = useObjectMemo({\n    webviewType,\n    hasCustomPanelHeaderAfter,\n    customPanelHeaderAfterMinWidth,\n    isWebView,\n    transitionMotionEnabled,\n    platform,\n    locale,\n    appearance,\n  });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      <TokensClassProvider platform={platform} appearance={appearance}>\n        {children}\n      </TokensClassProvider>\n    </ConfigProviderContext.Provider>\n  );\n};\n"],"names":["React","noop","generateVKUITokensClassName","useAutoDetectAppearance","useObjectMemo","useDOM","TokensClassProvider","useIsomorphicLayoutEffect","addClassNameToElement","excludeKeysWithUndefined","removeClassNameFromElement","warnOnce","ConfigProviderContext","useConfigProvider","WebviewType","warn","ConfigProvider","propsRaw","props","parentConfig","children","webviewType","hasCustomPanelHeaderAfter","hasCustomPanelHeaderAfterMerged","customPanelHeaderAfterMinWidth","isWebView","transitionMotionEnabled","platform","locale","appearance","appearanceProp","onDetectAppearanceByBridge","undefined","VKAPPS","process","env","NODE_ENV","webviewTypeRule","INTERNAL","document","attachVKUITokensClassNameToBody","VKUITokensClassName","body","configContext","Provider","value"],"mappings":";AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,2BAA2B,QAAQ,4CAA4C;AACxF,SAASC,uBAAuB,QAAQ,sCAAsC;AAC9E,SAASC,aAAa,QAAQ,4BAA4B;AAC1D,SAASC,MAAM,QAAQ,gBAAgB;AACvC,SAASC,mBAAmB,QAAQ,gCAAgC;AACpE,SAASC,yBAAyB,QAAQ,sCAAsC;AAChF,SACEC,qBAAqB,EACrBC,wBAAwB,EACxBC,0BAA0B,QACrB,kBAAkB;AACzB,SAASC,QAAQ,QAAQ,qBAAqB;AAC9C,SACEC,qBAAqB,EAErBC,iBAAiB,EACjBC,WAAW,QACN,0BAA0B;AAEjC,IAAMC,OAAOJ,SAAS;AActB;;CAEC,GACD,OAAO,IAAMK,iBAAiB,SAACC;IAC7B,IAAMC,QAAQT,yBAAyBQ;IACvC,IAAME,eAAeN;IAErB,IAWI,mBAAA,mBACCM,cACAD,QAZHE,WAUE,iBAVFA,UACAC,cASE,iBATFA,aACAC,AAA2BC,kCAQzB,iBARFD,2BACAE,iCAOE,iBAPFA,gCACAC,YAME,iBANFA,WACAC,0BAKE,iBALFA,yBACAC,WAIE,iBAJFA,UACAC,SAGE,iBAHFA,QACAC,AAAYC,iBAEV,iBAFFD,wDAEE,iBADFE,4BAAAA,oFAA6B9B;IAM/B,qCAAqC;IACrC,IAAMqB,4BACJJ,MAAMG,WAAW,IAAIH,MAAMI,yBAAyB,KAAKU,YACrDd,MAAMG,WAAW,KAAKP,YAAYmB,MAAM,GACxCV;IAEN,IAAIW,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAC1C,2BAA2B;QAC3B,IAAIC,kBAAkB;QACtB,IAAInB,MAAMG,WAAW,EAAE;YACrBgB,kBACEnB,MAAMG,WAAW,KAAKP,YAAYwB,QAAQ,GACtC,4FACA;QACR;QACAvB,KAAK,AAAC,mPAIQ,OAAhBsB,iBAAgB;IAIhB;IAEA,yCAAyC;IACzC,IAAMR,aAAa1B,wBAAwB2B,gBAAgBC;IAE3D,IAAM,AAAEQ,WAAalC,SAAbkC;IAER,yFAAyF;IACzFhC,0BACE,SAASiC;QACP,IAAI,CAACD,UAAU;YACb;QACF;QAEA,IAAME,sBAAsBvC,4BAA4ByB,UAAUE;QAElErB,sBAAsB+B,SAASG,IAAI,EAAED;QACrC,OAAO;YACL/B,2BAA2B6B,SAASG,IAAI,EAAED;QAC5C;IACF,GACA;QAACd;QAAUE;KAAW;IAGxB,IAAMc,gBAAgBvC,cAAc;QAClCiB,aAAAA;QACAC,2BAAAA;QACAE,gCAAAA;QACAC,WAAAA;QACAC,yBAAAA;QACAC,UAAAA;QACAC,QAAAA;QACAC,YAAAA;IACF;IAEA,qBACE,oBAACjB,sBAAsBgC,QAAQ;QAACC,OAAOF;qBACrC,oBAACrC;QAAoBqB,UAAUA;QAAUE,YAAYA;OAClDT;AAIT,EAAE"}