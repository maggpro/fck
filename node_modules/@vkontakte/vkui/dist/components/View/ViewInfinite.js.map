{"version":3,"sources":["../../../src/components/View/ViewInfinite.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { withContext } from '../../hoc/withContext';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { canUseDOM, DOMProps, withDOM } from '../../lib/dom';\nimport { getNavId, NavIdProps } from '../../lib/getNavId';\nimport { Platform } from '../../lib/platform';\nimport { animationEvent, transitionEvent } from '../../lib/supportEvents';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { HasPlatform, HTMLAttributesWithRootRef } from '../../types';\nimport { ScrollContext, ScrollContextInterface } from '../AppRoot/ScrollContext';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n} from '../ConfigProvider/ConfigProviderContext';\nimport { NavViewIdContext } from '../NavIdContext/NavIdContext';\nimport { NavTransitionProvider } from '../NavTransitionContext/NavTransitionContext';\nimport { NavTransitionDirectionProvider } from '../NavTransitionDirectionContext/NavTransitionDirectionContext';\nimport { SplitColContext, SplitColContextProps } from '../SplitCol/SplitColContext';\nimport { Touch, TouchEvent } from '../Touch/Touch';\nimport {\n  getSwipeBackPredicates,\n  hasHorizontalScrollableElementWithScrolledToLeft,\n  swipeBackExcluded,\n} from './utils';\nimport styles from './View.module.css';\n\nconst warn = warnOnce('ViewInfinite');\n\nenum SwipeBackResults {\n  fail = 1,\n  success,\n}\n\ninterface Scrolls {\n  [index: string]: Array<number | undefined>;\n}\n\ninterface ViewsScrolls {\n  [index: string]: Scrolls;\n}\n\ntype TransitionEventHandler = (e?: TransitionEvent) => void;\n\nexport let scrollsCache: ViewsScrolls = {};\n\nexport type TransitionParams = { from: string | null; to: string | null };\n\nexport interface ViewInfiniteProps\n  extends HTMLAttributesWithRootRef<HTMLElement>,\n    HasPlatform,\n    NavIdProps {\n  activePanel: string;\n  onTransition?(params: TransitionParams & { isBack: boolean }): void;\n  /**\n   * callback свайпа назад\n   */\n  onSwipeBack?(): void;\n  /**\n   * callback начала анимации свайпа назад.\n   */\n  onSwipeBackStart?(activePanel: string | null): void | 'prevent';\n  /**\n   * callback завершения анимации отмененного пользователем свайпа\n   */\n  onSwipeBackCancel?(): void;\n  history?: string[];\n  isBackCheck?(params: TransitionParams): boolean;\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  /**\n   * @ignore\n   */\n  scroll?: ScrollContextInterface;\n}\n\nexport interface ViewInfiniteState {\n  animated: boolean;\n\n  visiblePanels: Array<string | null>;\n  activePanel: string | null;\n  isBack?: boolean;\n  prevPanel: string | null;\n  nextPanel: string | null;\n\n  swipingBack?: boolean;\n  swipeBackStartX: number;\n  swipeBackShift: number;\n  swipeBackNextPanel: string | null;\n  swipeBackPrevPanel: string | null;\n  swipeBackResult: SwipeBackResults | null;\n\n  browserSwipe: boolean;\n}\n\nclass ViewInfiniteComponent extends React.Component<\n  ViewInfiniteProps & DOMProps,\n  ViewInfiniteState\n> {\n  constructor(props: ViewInfiniteProps) {\n    super(props);\n\n    this.state = {\n      animated: false,\n\n      visiblePanels: [props.activePanel],\n      activePanel: props.activePanel,\n      isBack: undefined,\n      prevPanel: null,\n      nextPanel: null,\n\n      swipingBack: undefined,\n      swipeBackStartX: 0,\n      swipeBackShift: 0,\n      swipeBackNextPanel: null,\n      swipeBackPrevPanel: null,\n      swipeBackResult: null,\n\n      browserSwipe: false,\n    };\n  }\n\n  static defaultProps: Partial<ViewInfiniteProps> = {\n    history: [],\n  };\n\n  private swipeBackPrevented = false;\n  private scrolls = scrollsCache[getNavId(this.props, warn) as string] || {};\n  private transitionFinishTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\n  private animationFinishTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  get panels() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  panelNodes: { [id: string]: HTMLDivElement | null } = {};\n\n  componentWillUnmount() {\n    const id = getNavId(this.props);\n    if (id) {\n      scrollsCache[id] = this.scrolls;\n    }\n    if (this.animationFinishTimeout) {\n      clearTimeout(this.animationFinishTimeout);\n    }\n  }\n\n  componentDidUpdate(prevProps: ViewInfiniteProps, prevState: ViewInfiniteState) {\n    // Нужен переход\n    if (\n      prevProps.activePanel !== this.props.activePanel &&\n      !prevState.swipingBack &&\n      !prevState.browserSwipe\n    ) {\n      let isBack = false;\n\n      if (this.props.isBackCheck) {\n        isBack = this.props.isBackCheck({\n          from: prevProps.activePanel,\n          to: this.props.activePanel,\n        });\n      } else {\n        const firstLayerId = this.panels\n          .map((panel) => getNavId(panel.props, warn))\n          .find((id) => id === prevProps.activePanel || id === this.props.activePanel);\n        isBack = firstLayerId === this.props.activePanel;\n      }\n\n      this.blurActiveElement();\n\n      const prevScrolls = this.scrolls[prevProps.activePanel] || [];\n      const scrolls = {\n        ...this.scrolls,\n        [prevProps.activePanel]: [...prevScrolls, this.props.scroll?.getScroll().y],\n      };\n      this.scrolls = scrolls;\n\n      if (this.shouldDisableTransitionMotion()) {\n        this.flushTransition(prevProps.activePanel, isBack);\n      } else {\n        this.setState({\n          visiblePanels: [prevProps.activePanel, this.props.activePanel],\n          prevPanel: prevProps.activePanel,\n          nextPanel: this.props.activePanel,\n          activePanel: null,\n          animated: true,\n          isBack,\n        });\n\n        // Фолбек анимации перехода\n        if (!animationEvent.supported) {\n          if (this.animationFinishTimeout) {\n            clearTimeout(this.animationFinishTimeout);\n          }\n          this.animationFinishTimeout = setTimeout(\n            this.transitionEndHandler,\n            this.props.platform === Platform.ANDROID || this.props.platform === Platform.VKCOM\n              ? 300\n              : 600,\n          );\n        }\n      }\n    }\n\n    // Закончилась анимация свайпа назад\n    if (prevProps.activePanel !== this.props.activePanel && prevState.swipingBack) {\n      const nextPanel = this.state.swipeBackNextPanel;\n      const prevPanel = this.state.swipeBackPrevPanel;\n      let scrollPosition: undefined | number = undefined;\n\n      this.scrolls = {\n        ...this.scrolls,\n      };\n\n      if (prevPanel !== null) {\n        const prevPanelScrolls = [...(this.scrolls[prevPanel] || [])].slice(0, -1);\n        this.scrolls[prevPanel] = prevPanelScrolls;\n      }\n      if (nextPanel !== null) {\n        const newPanelScrolls = [...(this.scrolls[nextPanel] || [])];\n        scrollPosition = newPanelScrolls.pop();\n        this.scrolls[nextPanel] = newPanelScrolls;\n      }\n\n      this.setState(\n        {\n          swipeBackPrevPanel: null,\n          swipeBackNextPanel: null,\n          swipingBack: false,\n          swipeBackResult: null,\n          swipeBackStartX: 0,\n          swipeBackShift: 0,\n          activePanel: nextPanel,\n          visiblePanels: [nextPanel],\n        },\n        () => {\n          this.props.scroll?.scrollTo(0, scrollPosition);\n          prevProps.onTransition &&\n            prevProps.onTransition({\n              isBack: true,\n              from: prevPanel,\n              to: nextPanel,\n            });\n        },\n      );\n    }\n\n    // Началась анимация завершения свайпа назад.\n    if (!prevState.swipeBackResult && this.state.swipeBackResult) {\n      this.waitTransitionFinish(\n        this.pickPanel(this.state.swipeBackNextPanel),\n        this.swipingBackTransitionEndHandler,\n      );\n    }\n\n    // Если свайп назад отменился (когда пользователь недостаточно сильно свайпнул)\n    if (\n      prevState.swipeBackResult === SwipeBackResults.fail &&\n      !this.state.swipeBackResult &&\n      this.state.activePanel !== null\n    ) {\n      const newPanelScrolls = [...(this.scrolls[this.state.activePanel] || [])];\n      const scrollPosition = newPanelScrolls.pop();\n      this.scrolls = {\n        ...this.scrolls,\n        [this.state.activePanel]: newPanelScrolls,\n      };\n\n      this.props.scroll?.scrollTo(0, scrollPosition);\n    }\n\n    // Закончился Safari свайп\n    if (prevProps.activePanel !== this.props.activePanel && this.state.browserSwipe) {\n      this.setState({\n        browserSwipe: false,\n        nextPanel: null,\n        prevPanel: null,\n        animated: false,\n        visiblePanels: [this.props.activePanel],\n        activePanel: this.props.activePanel,\n      });\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return (\n      this.props.configProvider?.transitionMotionEnabled === false ||\n      !this.props.splitCol?.animate ||\n      this.props.platform === Platform.VKCOM\n    );\n  }\n\n  waitTransitionFinish(\n    elem: HTMLElement | null | undefined,\n    eventHandler: TransitionEventHandler,\n  ): void {\n    if (transitionEvent.supported && transitionEvent.name && elem) {\n      elem.removeEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener,\n      );\n      elem.addEventListener(\n        transitionEvent.name as keyof HTMLElementEventMap,\n        eventHandler as EventListener,\n      );\n    } else {\n      if (this.transitionFinishTimeout) {\n        clearTimeout(this.transitionFinishTimeout);\n      }\n\n      this.transitionFinishTimeout = setTimeout(\n        eventHandler,\n        this.props.platform === Platform.ANDROID || this.props.platform === Platform.VKCOM\n          ? 300\n          : 600,\n      );\n    }\n  }\n\n  blurActiveElement(): void {\n    if (typeof this.window !== 'undefined' && this.document?.activeElement) {\n      (this.document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  pickPanel(id: string | null) {\n    if (id === null) {\n      return undefined;\n    }\n    return this.panelNodes[id];\n  }\n\n  flushTransition(prevPanel: string, isBack: boolean) {\n    const activePanel = this.props.activePanel;\n\n    const prevPanelScrolls = [...(this.scrolls[prevPanel] || [])].slice(0, -1);\n    const newPanelScrolls = [...(this.scrolls[activePanel] || [])];\n    const scrollPosition = isBack ? newPanelScrolls.pop() : 0;\n    if (isBack) {\n      this.scrolls = {\n        ...this.scrolls,\n        [prevPanel]: prevPanelScrolls,\n        [activePanel]: newPanelScrolls,\n      };\n    }\n\n    this.setState(\n      {\n        prevPanel: null,\n        nextPanel: null,\n        visiblePanels: [activePanel],\n        activePanel: activePanel,\n        animated: false,\n        isBack,\n      },\n      () => {\n        this.props.scroll?.scrollTo(0, isBack ? scrollPosition : 0);\n        this.props.onTransition &&\n          this.props.onTransition({ isBack, from: prevPanel, to: activePanel });\n      },\n    );\n  }\n\n  transitionEndHandler = (e?: React.AnimationEvent): void => {\n    if (\n      (!e ||\n        [\n          styles['animation-ios-next-forward'],\n          styles['animation-ios-prev-back'],\n          styles['animation-view-next-forward'],\n          styles['animation-view-prev-back'],\n        ].includes(e.animationName)) &&\n      this.state.prevPanel !== null\n    ) {\n      this.flushTransition(this.state.prevPanel, Boolean(this.state.isBack));\n    }\n  };\n\n  swipingBackTransitionEndHandler = (e?: TransitionEvent): void => {\n    // indexOf because of vendor prefixes in old browsers\n    if (\n      !e ||\n      (e.propertyName.includes('transform') &&\n        e.target === this.pickPanel(this.state.swipeBackNextPanel))\n    ) {\n      switch (this.state.swipeBackResult) {\n        case SwipeBackResults.fail:\n          this.onSwipeBackCancel();\n          break;\n        case SwipeBackResults.success:\n          this.onSwipeBackSuccess();\n      }\n    }\n  };\n\n  onSwipeBackSuccess(): void {\n    this.props.onSwipeBack && this.props.onSwipeBack();\n  }\n\n  onSwipeBackCancel(): void {\n    this.props.onSwipeBackCancel && this.props.onSwipeBackCancel();\n    this.setState({\n      swipeBackPrevPanel: null,\n      swipeBackNextPanel: null,\n      swipingBack: false,\n      swipeBackResult: null,\n      swipeBackStartX: 0,\n      swipeBackShift: 0,\n    });\n  }\n\n  handleTouchMoveXForNativeIOSSwipeBackOrSwipeNext = (event: TouchEvent) => {\n    if (this.state.browserSwipe) {\n      return;\n    }\n    const { swipeBackTriggered, viewportStartEdgeTouched, viewportEndEdgeTouched } =\n      getSwipeBackPredicates(event.startX, event.shiftX, this.window!.innerWidth);\n\n    if ((viewportStartEdgeTouched || viewportEndEdgeTouched) && swipeBackTriggered) {\n      this.setState({ browserSwipe: true });\n    }\n  };\n\n  handleTouchMoveXForIOSSwipeBackSimulation = (event: TouchEvent) => {\n    if (this.swipeBackPrevented || swipeBackExcluded(event)) {\n      return;\n    }\n\n    const { swipedToOpposite, swipeBackTriggered, viewportStartEdgeTouched } =\n      getSwipeBackPredicates(event.startX, event.shiftX, this.window!.innerWidth);\n\n    if (this.state.animated && swipeBackTriggered) {\n      return;\n    }\n\n    if (!this.state.swipingBack && this.props.history && this.props.history.length > 1) {\n      if (swipedToOpposite) {\n        this.swipeBackPrevented = true;\n        return;\n      }\n\n      if (!swipeBackTriggered) {\n        return;\n      }\n\n      if (\n        !viewportStartEdgeTouched &&\n        hasHorizontalScrollableElementWithScrolledToLeft(event.originalEvent.target as HTMLElement)\n      ) {\n        this.swipeBackPrevented = true;\n        return;\n      }\n      // Начался свайп назад\n      if (this.props.onSwipeBackStart) {\n        const payload = this.props.onSwipeBackStart(this.state.activePanel);\n        if (payload === 'prevent') {\n          this.swipeBackPrevented = true;\n          return;\n        }\n      }\n\n      if (this.state.activePanel !== null) {\n        // Note: вызываем закрытие клавиатуры. В iOS это нативное поведение при свайпе.\n        this.blurActiveElement();\n        const prevScrolls = this.scrolls[this.state.activePanel] || [];\n        this.scrolls = {\n          ...this.scrolls,\n          [this.state.activePanel]: [...prevScrolls, this.props.scroll?.getScroll().y],\n        };\n      }\n\n      this.setState({\n        swipingBack: true,\n        swipeBackStartX: event.startX,\n        swipeBackPrevPanel: this.state.activePanel,\n        swipeBackNextPanel: this.props.history.slice(-2)[0],\n      });\n    }\n\n    if (this.state.swipingBack) {\n      if (event.shiftX < 0) {\n        this.setState({ swipeBackShift: 0 });\n      } else if (event.shiftX > this.window!.innerWidth - this.state.swipeBackStartX) {\n        this.setState({ swipeBackShift: this.window!.innerWidth });\n      } else {\n        this.setState({ swipeBackShift: event.shiftX });\n      }\n    }\n  };\n\n  handleTouchEndForIOSSwipeBackSimulation = (event: TouchEvent) => {\n    this.swipeBackPrevented = false;\n\n    if (this.state.swipingBack && this.window) {\n      const speed = (this.state.swipeBackShift / event.duration) * 1000;\n      if (this.state.swipeBackShift === 0) {\n        this.onSwipeBackCancel();\n      } else if (this.state.swipeBackShift >= this.window.innerWidth) {\n        this.onSwipeBackSuccess();\n      } else if (speed > 250 || this.state.swipeBackShift >= this.window.innerWidth / 2) {\n        this.setState({ swipeBackResult: SwipeBackResults.success });\n      } else {\n        this.setState({ swipeBackResult: SwipeBackResults.fail });\n      }\n    }\n  };\n\n  calcPanelSwipeStyles(panelId: string | undefined): React.CSSProperties {\n    if (!canUseDOM || !this.window) {\n      return {};\n    }\n\n    const isPrev = panelId === this.state.swipeBackPrevPanel;\n    const isNext = panelId === this.state.swipeBackNextPanel;\n\n    if ((!isPrev && !isNext) || this.state.swipeBackResult) {\n      return {};\n    }\n\n    let prevPanelTranslate = `${this.state.swipeBackShift}px`;\n    let nextPanelTranslate = `${\n      -50 + (this.state.swipeBackShift * 100) / this.window.innerWidth / 2\n    }%`;\n    let prevPanelShadow =\n      (0.3 * (this.window.innerWidth - this.state.swipeBackShift)) / this.window.innerWidth;\n\n    if (this.state.swipeBackResult) {\n      return isPrev ? { boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})` } : {};\n    }\n\n    if (isNext) {\n      return {\n        transform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n      };\n    }\n    if (isPrev) {\n      return {\n        transform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})`,\n      };\n    }\n\n    return {};\n  }\n\n  render() {\n    const {\n      platform,\n      activePanel: _1,\n      splitCol,\n      configProvider,\n      history,\n      id,\n      nav,\n      onTransition,\n      onSwipeBack,\n      onSwipeBackStart,\n      onSwipeBackCancel,\n      window,\n      document,\n      scroll,\n      isBackCheck,\n      className,\n      ...restProps\n    } = this.props;\n    const {\n      prevPanel,\n      nextPanel,\n      activePanel,\n      isBack,\n      animated,\n      swipeBackPrevPanel,\n      swipeBackNextPanel,\n      swipeBackResult,\n      swipingBack,\n    } = this.state;\n\n    const panels = this.panels\n      .filter((panel) => {\n        const panelId = getNavId(panel.props, warn);\n\n        return (\n          (panelId !== undefined && this.state.visiblePanels.includes(panelId)) ||\n          panelId === swipeBackPrevPanel ||\n          panelId === swipeBackNextPanel\n        );\n      })\n      .sort((panel) => {\n        const panelId = getNavId(panel.props, warn);\n        const isPrevPanel = panelId === prevPanel || panelId === swipeBackPrevPanel;\n        const isNextPanel = panelId === nextPanel || panelId === swipeBackNextPanel;\n\n        if (isNextPanel) {\n          return swipingBack || this.state.isBack ? -1 : 1;\n        }\n\n        if (isPrevPanel) {\n          return swipingBack || this.state.isBack ? 1 : -1;\n        }\n\n        return 0;\n      });\n\n    const disableAnimation = this.shouldDisableTransitionMotion();\n    const iOSSwipeBackSimulationEnabled =\n      !disableAnimation &&\n      platform === Platform.IOS &&\n      configProvider?.isWebView &&\n      Boolean(onSwipeBack);\n\n    return (\n      <NavViewIdContext.Provider value={id || nav}>\n        <Touch\n          Component=\"section\"\n          {...restProps}\n          className={classNames(\n            styles['View'],\n            platform === Platform.IOS && classNames(styles['View--ios'], 'vkuiInternalView--ios'),\n            !disableAnimation && this.state.animated && styles['View--animated'],\n            !disableAnimation && this.state.swipingBack && styles['View--swiping-back'],\n            disableAnimation && styles['View--no-motion'],\n            className,\n          )}\n          onMoveX={\n            iOSSwipeBackSimulationEnabled\n              ? this.handleTouchMoveXForIOSSwipeBackSimulation\n              : platform === Platform.IOS\n              ? this.handleTouchMoveXForNativeIOSSwipeBackOrSwipeNext\n              : undefined\n          }\n          onEnd={\n            iOSSwipeBackSimulationEnabled ? this.handleTouchEndForIOSSwipeBackSimulation : undefined\n          }\n        >\n          <div className={styles['View__panels']}>\n            {panels.map((panel: React.ReactElement) => {\n              const panelId = getNavId(panel.props, warn);\n              const isPrev = panelId === prevPanel || panelId === swipeBackPrevPanel;\n              const compensateScroll =\n                isPrev || panelId === swipeBackNextPanel || (panelId === nextPanel && isBack);\n              const isTransitionTarget = animated && panelId === (isBack ? prevPanel : nextPanel);\n              const scrollList = (panelId && this.scrolls[panelId]) || [];\n              const scroll = scrollList[scrollList.length - 1] || 0;\n\n              return (\n                <div\n                  className={classNames(\n                    styles['View__panel'],\n                    panelId === activePanel && styles['View__panel--active'],\n                    panelId === prevPanel && styles['View__panel--prev'],\n                    panelId === nextPanel && styles['View__panel--next'],\n                    panelId === swipeBackPrevPanel && styles['View__panel--swipe-back-prev'],\n                    panelId === swipeBackNextPanel && styles['View__panel--swipe-back-next'],\n                    swipeBackResult === SwipeBackResults.success &&\n                      styles['View__panel--swipe-back-success'],\n                    swipeBackResult === SwipeBackResults.fail &&\n                      styles['View__panel--swipe-back-failed'],\n                  )}\n                  onAnimationEnd={isTransitionTarget ? this.transitionEndHandler : undefined}\n                  ref={(el) => panelId !== undefined && (this.panelNodes[panelId] = el)}\n                  style={this.calcPanelSwipeStyles(panelId)}\n                  key={panelId}\n                >\n                  <div\n                    className={styles['View__panel-in']}\n                    style={{ marginTop: compensateScroll ? -scroll : undefined }}\n                  >\n                    <NavTransitionDirectionProvider isBack={swipingBack || isBack}>\n                      <NavTransitionProvider\n                        entering={panelId === nextPanel || panelId === swipeBackNextPanel}\n                      >\n                        {panel}\n                      </NavTransitionProvider>\n                    </NavTransitionDirectionProvider>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </Touch>\n      </NavViewIdContext.Provider>\n    );\n  }\n}\n\nexport const ViewInfinite = withContext(\n  withContext(\n    withContext(\n      withPlatform(withDOM<ViewInfiniteProps>(ViewInfiniteComponent)),\n      SplitColContext,\n      'splitCol',\n    ),\n    ConfigProviderContext,\n    'configProvider',\n  ),\n  ScrollContext,\n  'scroll',\n);\n"],"names":["React","classNames","withContext","withPlatform","canUseDOM","withDOM","getNavId","Platform","animationEvent","transitionEvent","warnOnce","ScrollContext","ConfigProviderContext","NavViewIdContext","NavTransitionProvider","NavTransitionDirectionProvider","SplitColContext","Touch","getSwipeBackPredicates","hasHorizontalScrollableElementWithScrolledToLeft","swipeBackExcluded","warn","SwipeBackResults","scrollsCache","ViewInfiniteComponent","props","swipeBackPrevented","scrolls","transitionFinishTimeout","undefined","animationFinishTimeout","panelNodes","transitionEndHandler","e","includes","animationName","state","prevPanel","flushTransition","Boolean","isBack","swipingBackTransitionEndHandler","propertyName","target","pickPanel","swipeBackNextPanel","swipeBackResult","onSwipeBackCancel","onSwipeBackSuccess","handleTouchMoveXForNativeIOSSwipeBackOrSwipeNext","event","browserSwipe","startX","shiftX","window","innerWidth","swipeBackTriggered","viewportStartEdgeTouched","viewportEndEdgeTouched","setState","handleTouchMoveXForIOSSwipeBackSimulation","swipedToOpposite","animated","swipingBack","history","length","originalEvent","onSwipeBackStart","payload","activePanel","blurActiveElement","prevScrolls","scroll","getScroll","y","swipeBackStartX","swipeBackPrevPanel","slice","swipeBackShift","handleTouchEndForIOSSwipeBackSimulation","speed","duration","visiblePanels","nextPanel","document","panels","Children","toArray","children","componentWillUnmount","id","clearTimeout","componentDidUpdate","prevProps","prevState","isBackCheck","from","to","firstLayerId","map","panel","find","shouldDisableTransitionMotion","supported","setTimeout","platform","ANDROID","VKCOM","scrollPosition","prevPanelScrolls","newPanelScrolls","pop","scrollTo","onTransition","waitTransitionFinish","configProvider","transitionMotionEnabled","splitCol","animate","elem","eventHandler","name","removeEventListener","addEventListener","activeElement","blur","onSwipeBack","calcPanelSwipeStyles","panelId","isPrev","isNext","prevPanelTranslate","nextPanelTranslate","prevPanelShadow","boxShadow","transform","WebkitTransform","render","_1","nav","className","restProps","filter","sort","isPrevPanel","isNextPanel","disableAnimation","iOSSwipeBackSimulationEnabled","IOS","isWebView","Provider","value","Component","onMoveX","onEnd","div","compensateScroll","isTransitionTarget","scrollList","onAnimationEnd","ref","el","style","key","marginTop","entering","defaultProps","ViewInfinite"],"mappings":"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"}