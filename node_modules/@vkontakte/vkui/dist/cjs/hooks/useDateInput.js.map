{"version":3,"sources":["../../../src/hooks/useDateInput.ts"],"sourcesContent":["import * as React from 'react';\nimport { useDOM } from '../lib/dom';\nimport { useBooleanState } from './useBooleanState';\nimport { useGlobalEventListener } from './useGlobalEventListener';\n\nexport interface UseDateInputDependencies<T, D> {\n  maxElement: number;\n  refs: Array<React.RefObject<T>>;\n  autoFocus?: boolean;\n  disabled?: boolean;\n  value?: D;\n  elementsConfig(index: number): {\n    length: number;\n    min: number;\n    max: number;\n  };\n  onInternalValueChange(value: string[]): void;\n  getInternalValue(value?: D | undefined): string[];\n  onChange?(value?: D | undefined): void;\n}\n\nexport function useDateInput<T extends HTMLElement, D>({\n  maxElement,\n  refs,\n  autoFocus,\n  disabled,\n  elementsConfig,\n  onChange,\n  onInternalValueChange,\n  getInternalValue,\n  value,\n}: UseDateInputDependencies<T, D>) {\n  const { document } = useDOM();\n  const { value: open, setTrue: openCalendar, setFalse: closeCalendar } = useBooleanState(false);\n  const rootRef = React.useRef<HTMLDivElement>(null);\n  const calendarRef = React.useRef<HTMLDivElement>(null);\n  const [internalValue, setInternalValue] = React.useState<string[]>([]);\n  const [focusedElement, setFocusedElement] = React.useState<number | null>(null);\n  const { window } = useDOM();\n\n  const removeFocusFromField = React.useCallback(() => {\n    if (focusedElement !== null) {\n      setFocusedElement(null);\n      closeCalendar();\n      window!.getSelection()?.removeAllRanges();\n      setInternalValue(getInternalValue(value));\n    }\n  }, [focusedElement, closeCalendar, getInternalValue, value, window]);\n\n  const handleClickOutside = React.useCallback(\n    (e: MouseEvent) => {\n      if (\n        !rootRef.current?.contains(e.target as Node | null) &&\n        !calendarRef.current?.contains(e.target as Node | null)\n      ) {\n        removeFocusFromField();\n      }\n    },\n    [removeFocusFromField],\n  );\n\n  const selectFirst = React.useCallback(() => {\n    setFocusedElement(0);\n  }, []);\n\n  useGlobalEventListener(document, 'click', handleClickOutside, {\n    capture: true,\n  });\n\n  React.useEffect(() => {\n    setInternalValue(getInternalValue(value));\n  }, [getInternalValue, value]);\n\n  React.useEffect(() => {\n    if (autoFocus) {\n      selectFirst();\n    }\n  }, [autoFocus, selectFirst]);\n\n  React.useEffect(() => {\n    if (disabled || focusedElement === null) {\n      return;\n    }\n\n    const range = window!.document.createRange();\n\n    let element = refs[focusedElement].current;\n\n    if (element) {\n      element.focus();\n      openCalendar();\n      range.selectNodeContents(element as Node);\n\n      const selection = window!.getSelection();\n      selection?.removeAllRanges();\n      selection?.addRange(range);\n    }\n  }, [disabled, focusedElement, openCalendar, refs, window]);\n\n  const clear = React.useCallback(() => {\n    onChange?.(undefined);\n    selectFirst();\n  }, [onChange, selectFirst]);\n\n  const handleFieldEnter = React.useCallback(() => {\n    if (!open) {\n      selectFirst();\n    }\n  }, [open, selectFirst]);\n\n  const handleKeyDown = React.useCallback(\n    (e: React.KeyboardEvent<HTMLSpanElement>) => {\n      if (focusedElement === null) {\n        return;\n      }\n\n      const _value = [...internalValue];\n      const config = elementsConfig(focusedElement);\n\n      if (/^\\d+$/.test(e.key)) {\n        if (_value[focusedElement].length >= config.length) {\n          _value[focusedElement] = e.key;\n        } else {\n          _value[focusedElement] += e.key;\n          if (_value[focusedElement].length >= config.length && focusedElement < maxElement) {\n            setFocusedElement(focusedElement + 1);\n          }\n        }\n      } else if (e.key === 'Backspace') {\n        if (!_value[focusedElement]) {\n          setFocusedElement(focusedElement <= 0 ? maxElement : focusedElement - 1);\n        } else {\n          _value[focusedElement] = _value[focusedElement].slice(0, -1);\n        }\n      } else if (e.key === 'ArrowDown' || e.key === 'Down') {\n        let currentValue = Number(_value[focusedElement]);\n        _value[focusedElement] = String(\n          currentValue <= config.min ? config.max : currentValue - 1,\n        ).padStart(config.length, '0');\n      } else if (e.key === 'ArrowUp' || e.key === 'Up') {\n        let currentValue = Number(_value[focusedElement]);\n        _value[focusedElement] = String(\n          currentValue >= config.max ? config.min : currentValue + 1,\n        ).padStart(config.length, '0');\n      } else if (\n        e.key === 'Enter' ||\n        (e.key === 'Tab' && focusedElement === maxElement) ||\n        (e.key === 'Tab' && e.shiftKey && focusedElement === 0)\n      ) {\n        removeFocusFromField();\n        return;\n      } else if (e.key === 'ArrowLeft' || e.key === 'Left' || (e.key === 'Tab' && e.shiftKey)) {\n        setFocusedElement(focusedElement <= 0 ? maxElement : focusedElement - 1);\n      } else if (e.key === 'ArrowRight' || e.key === 'Right' || e.key === 'Tab') {\n        setFocusedElement(focusedElement >= maxElement ? 0 : focusedElement + 1);\n      } else if (e.key === 'Delete' || e.key === 'Del') {\n        _value[focusedElement] = '';\n      } else {\n        return;\n      }\n\n      e.preventDefault();\n      setInternalValue(_value);\n      onInternalValueChange(_value);\n    },\n    [\n      elementsConfig,\n      focusedElement,\n      internalValue,\n      maxElement,\n      onInternalValueChange,\n      removeFocusFromField,\n    ],\n  );\n\n  return {\n    rootRef,\n    calendarRef,\n    open,\n    openCalendar,\n    closeCalendar,\n    internalValue,\n    focusedElement,\n    setFocusedElement,\n    handleKeyDown,\n    clear,\n    handleFieldEnter,\n    removeFocusFromField,\n  };\n}\n"],"names":["useDateInput","maxElement","refs","autoFocus","disabled","elementsConfig","onChange","onInternalValueChange","getInternalValue","value","document","useDOM","useBooleanState","open","setTrue","openCalendar","setFalse","closeCalendar","rootRef","React","useRef","calendarRef","useState","internalValue","setInternalValue","focusedElement","setFocusedElement","window","removeFocusFromField","useCallback","getSelection","removeAllRanges","handleClickOutside","e","current","contains","target","selectFirst","useGlobalEventListener","capture","useEffect","range","createRange","element","focus","selectNodeContents","selection","addRange","clear","undefined","handleFieldEnter","handleKeyDown","_value","config","test","key","length","slice","currentValue","Number","String","min","max","padStart","shiftKey","preventDefault"],"mappings":"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"}