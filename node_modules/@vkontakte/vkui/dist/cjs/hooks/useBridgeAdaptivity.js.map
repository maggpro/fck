{"version":3,"sources":["../../../src/hooks/useBridgeAdaptivity.ts"],"sourcesContent":["import * as React from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\nexport interface BridgeAdaptivity {\n  type: '' | 'force_mobile' | 'force_mobile_compact' | 'adaptive';\n  viewportWidth: number;\n  viewportHeight: number;\n}\n\ninterface BridgeEvent {\n  detail: {\n    type: string;\n    data: {\n      [index: string]: any;\n    };\n  };\n}\n\nlet initialState: BridgeAdaptivity = {\n  type: '',\n  viewportWidth: 0,\n  viewportHeight: 0,\n};\n\nfunction resolveAdaptivity(data: any): BridgeAdaptivity | null {\n  const { adaptivity, viewport_width, viewport_height } = data;\n\n  const bridgeAdaptivity: BridgeAdaptivity = {\n    type: '',\n    viewportWidth: isFinite(viewport_width) ? Number(viewport_width) : 0,\n    viewportHeight: isFinite(viewport_height) ? Number(viewport_height) : 0,\n  };\n\n  switch (adaptivity) {\n    case 'force_mobile':\n    case 'force_mobile_compact':\n    case 'adaptive':\n      bridgeAdaptivity.type = adaptivity;\n  }\n\n  return bridgeAdaptivity;\n}\n\n/**\n * TODO [>=6]: удалить хук (#5049)\n * @deprecated v5.8.0\n */\nexport function useBridgeAdaptivity(disable = false): BridgeAdaptivity {\n  const [bridgeAdaptivity, setBridgeAdaptivity] = React.useState<BridgeAdaptivity>(initialState);\n\n  useIsomorphicLayoutEffect(() => {\n    if (disable) {\n      return;\n    }\n\n    const updateAdaptivity = (data: any) => {\n      if (!('adaptivity' in data) || !('viewport_width' in data) || !('viewport_height' in data)) {\n        return;\n      }\n\n      const newAdaptivity = resolveAdaptivity(data);\n\n      if (newAdaptivity) {\n        setBridgeAdaptivity(newAdaptivity);\n      }\n    };\n\n    const handleBridgeEvent = (event: BridgeEvent) => {\n      const { type, data } = event.detail;\n\n      if (type !== 'VKWebAppUpdateConfig') {\n        return;\n      }\n\n      updateAdaptivity(data);\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send('VKWebAppGetConfig').then(updateAdaptivity).catch(console.error);\n\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n\n  return bridgeAdaptivity;\n}\n"],"names":["useBridgeAdaptivity","initialState","type","viewportWidth","viewportHeight","resolveAdaptivity","data","adaptivity","viewport_width","viewport_height","bridgeAdaptivity","isFinite","Number","disable","React","useState","setBridgeAdaptivity","useIsomorphicLayoutEffect","updateAdaptivity","newAdaptivity","handleBridgeEvent","event","detail","vkBridge","subscribe","send","then","catch","console","error","unsubscribe"],"mappings":";;;;+BAgDgBA;;;eAAAA;;;;;;+DAhDO;iEACF;yCACqB;AAiB1C,IAAIC,eAAiC;IACnCC,MAAM;IACNC,eAAe;IACfC,gBAAgB;AAClB;AAEA,SAASC,kBAAkBC,IAAS;IAClC,IAAQC,aAAgDD,KAAhDC,YAAYC,iBAAoCF,KAApCE,gBAAgBC,kBAAoBH,KAApBG;IAEpC,IAAMC,mBAAqC;QACzCR,MAAM;QACNC,eAAeQ,SAASH,kBAAkBI,OAAOJ,kBAAkB;QACnEJ,gBAAgBO,SAASF,mBAAmBG,OAAOH,mBAAmB;IACxE;IAEA,OAAQF;QACN,KAAK;QACL,KAAK;QACL,KAAK;YACHG,iBAAiBR,IAAI,GAAGK;IAC5B;IAEA,OAAOG;AACT;AAMO,SAASV;QAAoBa,UAAAA,iEAAU;IAC5C,IAAgDC,qCAAAA,OAAMC,QAAQ,CAAmBd,mBAA1ES,mBAAyCI,oBAAvBE,sBAAuBF;IAEhDG,IAAAA,oDAAyB,EAAC;QACxB,IAAIJ,SAAS;YACX;QACF;QAEA,IAAMK,mBAAmB,SAACZ;YACxB,IAAI,CAAE,CAAA,gBAAgBA,IAAG,KAAM,CAAE,CAAA,oBAAoBA,IAAG,KAAM,CAAE,CAAA,qBAAqBA,IAAG,GAAI;gBAC1F;YACF;YAEA,IAAMa,gBAAgBd,kBAAkBC;YAExC,IAAIa,eAAe;gBACjBH,oBAAoBG;YACtB;QACF;QAEA,IAAMC,oBAAoB,SAACC;YACzB,IAAuBA,gBAAAA,MAAMC,MAAM,EAA3BpB,OAAemB,cAAfnB,MAAMI,OAASe,cAATf;YAEd,IAAIJ,SAAS,wBAAwB;gBACnC;YACF;YAEAgB,iBAAiBZ;QACnB;QAEAiB,iBAAQ,CAACC,SAAS,CAACJ;QACnBG,iBAAQ,CAACE,IAAI,CAAC,qBAAqBC,IAAI,CAACR,kBAAkBS,KAAK,CAACC,QAAQC,KAAK;QAE7E,OAAO;YACLN,iBAAQ,CAACO,WAAW,CAACV;QACvB;IACF,GAAG,EAAE;IAEL,OAAOV;AACT"}