{"version":3,"sources":["../../../../src/components/ActionSheet/ActionSheet.tsx"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { Platform } from '../../lib/platform';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport { ActionSheetDefaultIosCloseItem } from './ActionSheetDefaultIosCloseItem';\nimport { ActionSheetDropdownMenu } from './ActionSheetDropdownMenu';\nimport { ActionSheetDropdownSheet } from './ActionSheetDropdownSheet';\nimport { SharedDropdownProps } from './types';\nimport styles from './ActionSheet.module.css';\n\nconst warn = warnOnce('ActionSheet');\ntype CloseInitiators = 'action-item' | 'cancel-item' | 'other';\nexport interface ActionSheetOnCloseOptions {\n  closedBy: CloseInitiators;\n}\n\nexport interface ActionSheetProps\n  extends Pick<\n      SharedDropdownProps,\n      'toggleRef' | 'popupDirection' | 'popupOffsetDistance' | 'placement'\n    >,\n    React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи.\n   */\n  onClose(options: ActionSheetOnCloseOptions): void;\n  /**\n   * Только мобильный iOS.\n   */\n  iosCloseItem?: React.ReactNode;\n  mode?: 'sheet' | 'menu';\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport const ActionSheet = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  popupDirection,\n  popupOffsetDistance,\n  placement,\n  mode: modeProp,\n  ...restProps\n}: ActionSheetProps) => {\n  const platform = usePlatform();\n  const [closingBy, setClosingBy] = React.useState<undefined | CloseInitiators>(undefined);\n  const onClose = () => setClosingBy('other');\n  const _action = React.useRef(noop);\n\n  const afterClose = () => {\n    restProps.onClose({ closedBy: closingBy || 'other' });\n    _action.current();\n    _action.current = noop;\n  };\n\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n  const mode = modeProp ?? (isDesktop ? 'menu' : 'sheet');\n\n  useScrollLock(mode === 'sheet');\n\n  let timeout = platform === Platform.IOS ? 300 : 200;\n\n  if (mode === 'menu') {\n    timeout = 0;\n  }\n\n  const fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(() => {\n    if (closingBy) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closingBy, fallbackTransitionFinish]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    ({ action, immediateAction, autoClose, isCancelItem }) =>\n      (event) => {\n        event.persist();\n        immediateAction && immediateAction(event);\n        if (autoClose) {\n          _action.current = () => action && action(event);\n          setClosingBy(isCancelItem ? 'cancel-item' : 'action-item');\n        } else {\n          action && action(event);\n        }\n      },\n    [],\n  );\n  const contextValue = useObjectMemo({ onItemClick, mode });\n\n  const DropdownComponent = mode === 'menu' ? ActionSheetDropdownMenu : ActionSheetDropdownSheet;\n\n  if (process.env.NODE_ENV === 'development' && popupDirection) {\n    // TODO [>=6]: popupDirection\n    warn('Свойство \"popupDirection\" будет удалено в v6. Используйте свойство \"placement\"');\n  }\n\n  popupDirection = popupDirection !== undefined ? popupDirection : 'bottom';\n\n  const dropdownProps =\n    mode === 'menu'\n      ? Object.assign(restProps, { popupOffsetDistance, popupDirection, placement })\n      : restProps;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={Boolean(closingBy)}\n        timeout={timeout}\n        {...dropdownProps}\n        onClose={onClose}\n        className={mode === 'menu' ? className : undefined}\n        style={mode === 'menu' ? style : undefined}\n      >\n        <div className={styles['ActionSheet__content-wrapper']}>\n          {(header || text) && (\n            <div className={styles['ActionSheet__header']}>\n              {header && (\n                <Footnote weight=\"2\" className={styles['ActionSheet__title']}>\n                  {header}\n                </Footnote>\n              )}\n              {text && <Footnote className={styles['ActionSheet__text']}>{text}</Footnote>}\n            </div>\n          )}\n          {children}\n        </div>\n        {platform === Platform.IOS && mode === 'sheet' && (\n          <div className={styles['ActionSheet__close-item-wrapper--ios']}>\n            {iosCloseItem ?? <ActionSheetDefaultIosCloseItem />}\n          </div>\n        )}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (mode === 'menu') {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={Boolean(closingBy)}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onClose}\n      hasMask\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n"],"names":["ActionSheet","warn","warnOnce","children","className","header","text","style","iosCloseItem","popupDirection","popupOffsetDistance","placement","mode","modeProp","restProps","platform","usePlatform","React","useState","undefined","closingBy","setClosingBy","onClose","_action","useRef","noop","afterClose","closedBy","current","isDesktop","useAdaptivityWithJSMediaQueries","useScrollLock","timeout","Platform","IOS","fallbackTransitionFinish","useTimeout","useEffect","set","clear","onItemClick","useCallback","action","immediateAction","autoClose","isCancelItem","event","persist","contextValue","useObjectMemo","DropdownComponent","ActionSheetDropdownMenu","ActionSheetDropdownSheet","process","env","NODE_ENV","dropdownProps","Object","assign","actionSheet","ActionSheetContext","Provider","value","closing","Boolean","div","Footnote","weight","ActionSheetDefaultIosCloseItem","PopoutWrapper","alignY","onClick","hasMask","fixed"],"mappings":"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"}