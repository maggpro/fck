{"version":3,"sources":["../../../../src/components/ConfigProvider/ConfigProvider.tsx"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { generateVKUITokensClassName } from '../../helpers/generateVKUITokensClassName';\nimport { useAutoDetectAppearance } from '../../hooks/useAutoDetectAppearance';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { useDOM } from '../../lib/dom';\nimport { TokensClassProvider } from '../../lib/tokensClassProvider';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport {\n  addClassNameToElement,\n  excludeKeysWithUndefined,\n  removeClassNameFromElement,\n} from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  useConfigProvider,\n  WebviewType,\n} from './ConfigProviderContext';\n\nconst warn = warnOnce('ConfigProvider');\n\nexport interface ConfigProviderProps extends Partial<ConfigProviderContextInterface> {\n  /**\n   * > ⚠️ В **v6** метод будет удалён (см. https://github.com/VKCOM/VKUI/issues/5049).\n   * > Используйте хук `useAppearance()` из библиотеки `@vkontakte/vk-bridge-react`, если вам нужно\n   * > определять, что `appearance` был передан через VK Bridge.\n   *\n   * @deprecated v5.8.0\n   */\n  onDetectAppearanceByBridge?: () => void; // TODO [>=6]: удалить\n  children: React.ReactNode;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ConfigProvider\n */\nexport const ConfigProvider = (propsRaw: ConfigProviderProps) => {\n  const props = excludeKeysWithUndefined(propsRaw);\n  const parentConfig = useConfigProvider();\n\n  const {\n    children,\n    webviewType,\n    hasCustomPanelHeaderAfter: hasCustomPanelHeaderAfterMerged,\n    customPanelHeaderAfterMinWidth,\n    isWebView,\n    transitionMotionEnabled,\n    platform,\n    locale,\n    appearance: appearanceProp,\n    onDetectAppearanceByBridge = noop,\n  } = {\n    ...parentConfig,\n    ...props,\n  };\n\n  // TODO [>=6]: Удалить данный бэкпорт\n  const hasCustomPanelHeaderAfter =\n    props.webviewType && props.hasCustomPanelHeaderAfter === undefined\n      ? props.webviewType === WebviewType.VKAPPS\n      : hasCustomPanelHeaderAfterMerged;\n\n  if (process.env.NODE_ENV === 'development') {\n    // TODO [>=6]: удалить warn\n    let webviewTypeRule = '';\n    if (props.webviewType) {\n      webviewTypeRule =\n        props.webviewType === WebviewType.INTERNAL\n          ? '3. замените webviewType={WebviewType.INTERNAL} на hasCustomPanelHeaderAfterProp={false}'\n          : '3. замените webviewType={WebviewType.VKAPPS} на hasCustomPanelHeaderAfterProp={true}';\n    }\n    warn(`[@vkontakte/vk-bridge's deprecated] Если вы используете VK Bridge, то:\n\n1. используйте хук useAppearance() из @vkontakte/vk-bridge-react и результат передайте в параметр appearance;\n2. передайте bridge.isWebView() в параметр isWebView;\n${webviewTypeRule}\n\nПодробности см. https://github.com/VKCOM/VKUI/issues/5049\n`);\n  }\n\n  // TODO [>=6]: удалить использование хука\n  const appearance = useAutoDetectAppearance(appearanceProp, onDetectAppearanceByBridge);\n\n  const { document } = useDOM();\n\n  // TODO [>=6]: переместить хук в AppRoot (см. https://github.com/VKCOM/VKUI/issues/4810).\n  useIsomorphicLayoutEffect(\n    function attachVKUITokensClassNameToBody() {\n      if (!document) {\n        return;\n      }\n\n      const VKUITokensClassName = generateVKUITokensClassName(platform, appearance);\n\n      addClassNameToElement(document.body, VKUITokensClassName);\n      return () => {\n        removeClassNameFromElement(document.body, VKUITokensClassName);\n      };\n    },\n    [platform, appearance],\n  );\n\n  const configContext = useObjectMemo({\n    webviewType,\n    hasCustomPanelHeaderAfter,\n    customPanelHeaderAfterMinWidth,\n    isWebView,\n    transitionMotionEnabled,\n    platform,\n    locale,\n    appearance,\n  });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      <TokensClassProvider platform={platform} appearance={appearance}>\n        {children}\n      </TokensClassProvider>\n    </ConfigProviderContext.Provider>\n  );\n};\n"],"names":["ConfigProvider","warn","warnOnce","propsRaw","props","excludeKeysWithUndefined","parentConfig","useConfigProvider","children","webviewType","hasCustomPanelHeaderAfter","hasCustomPanelHeaderAfterMerged","customPanelHeaderAfterMinWidth","isWebView","transitionMotionEnabled","platform","locale","appearance","appearanceProp","onDetectAppearanceByBridge","noop","undefined","WebviewType","VKAPPS","process","env","NODE_ENV","webviewTypeRule","INTERNAL","useAutoDetectAppearance","document","useDOM","useIsomorphicLayoutEffect","attachVKUITokensClassNameToBody","VKUITokensClassName","generateVKUITokensClassName","addClassNameToElement","body","removeClassNameFromElement","configContext","useObjectMemo","ConfigProviderContext","Provider","value","TokensClassProvider"],"mappings":";;;;+BAsCaA;;;eAAAA;;;;;+DAtCU;oBACF;2CACuB;uCACJ;6BACV;mBACP;mCACa;yCACM;qBAKnC;wBACkB;qCAMlB;AAEP,IAAMC,OAAOC,IAAAA,kBAAQ,EAAC;AAiBf,IAAMF,iBAAiB,SAACG;IAC7B,IAAMC,QAAQC,IAAAA,+BAAwB,EAACF;IACvC,IAAMG,eAAeC,IAAAA,wCAAiB;IAEtC,IAWI,mBAAA,qBACCD,cACAF,QAZHI,WAUE,iBAVFA,UACAC,cASE,iBATFA,aACAC,AAA2BC,kCAQzB,iBARFD,2BACAE,iCAOE,iBAPFA,gCACAC,YAME,iBANFA,WACAC,0BAKE,iBALFA,yBACAC,WAIE,iBAJFA,UACAC,SAGE,iBAHFA,QACAC,AAAYC,iBAEV,iBAFFD,wDAEE,iBADFE,4BAAAA,oFAA6BC,UAAI;IAMnC,qCAAqC;IACrC,IAAMV,4BACJN,MAAMK,WAAW,IAAIL,MAAMM,yBAAyB,KAAKW,YACrDjB,MAAMK,WAAW,KAAKa,kCAAW,CAACC,MAAM,GACxCZ;IAEN,IAAIa,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAC1C,2BAA2B;QAC3B,IAAIC,kBAAkB;QACtB,IAAIvB,MAAMK,WAAW,EAAE;YACrBkB,kBACEvB,MAAMK,WAAW,KAAKa,kCAAW,CAACM,QAAQ,GACtC,4FACA;QACR;QACA3B,KAAK,AAAC,mPAIQ,OAAhB0B,iBAAgB;IAIhB;IAEA,yCAAyC;IACzC,IAAMV,aAAaY,IAAAA,gDAAuB,EAACX,gBAAgBC;IAE3D,IAAM,AAAEW,WAAaC,IAAAA,WAAM,IAAnBD;IAER,yFAAyF;IACzFE,IAAAA,oDAAyB,EACvB,SAASC;QACP,IAAI,CAACH,UAAU;YACb;QACF;QAEA,IAAMI,sBAAsBC,IAAAA,wDAA2B,EAACpB,UAAUE;QAElEmB,IAAAA,4BAAqB,EAACN,SAASO,IAAI,EAAEH;QACrC,OAAO;YACLI,IAAAA,iCAA0B,EAACR,SAASO,IAAI,EAAEH;QAC5C;IACF,GACA;QAACnB;QAAUE;KAAW;IAGxB,IAAMsB,gBAAgBC,IAAAA,4BAAa,EAAC;QAClC/B,aAAAA;QACAC,2BAAAA;QACAE,gCAAAA;QACAC,WAAAA;QACAC,yBAAAA;QACAC,UAAAA;QACAC,QAAAA;QACAC,YAAAA;IACF;IAEA,qBACE,qBAACwB,4CAAqB,CAACC,QAAQ;QAACC,OAAOJ;qBACrC,qBAACK,wCAAmB;QAAC7B,UAAUA;QAAUE,YAAYA;OAClDT;AAIT"}