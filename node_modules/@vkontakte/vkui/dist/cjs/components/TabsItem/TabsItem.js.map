{"version":3,"sources":["../../../../src/components/TabsItem/TabsItem.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { usePrevious } from '../../hooks/usePrevious';\nimport { SizeType } from '../../lib/adaptivity';\nimport { useDOM } from '../../lib/dom';\nimport { Platform } from '../../lib/platform';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { HTMLAttributesWithRootRef } from '../../types';\nimport { TabsContextProps, TabsModeContext } from '../Tabs/Tabs';\nimport { Tappable } from '../Tappable/Tappable';\nimport { Headline } from '../Typography/Headline/Headline';\nimport { Subhead } from '../Typography/Subhead/Subhead';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden';\nimport styles from './TabsItem.module.css';\n\nconst sizeYClassNames = {\n  none: styles['TabsItem--sizeY-none'],\n  [SizeType.COMPACT]: styles['TabsItem--sizeY-compact'],\n};\n\nconst stylesMode = {\n  default: styles['TabsItem--mode-default'],\n  accent: styles['TabsItem--mode-accent'],\n  secondary: styles['TabsItem--mode-secondary'],\n};\n\nconst fillModeClassNames = {\n  stretched: styles['TabsItem--stretched'],\n  shrinked: styles['TabsItem--shrinked'],\n};\n\nexport interface TabsItemProps extends HTMLAttributesWithRootRef<HTMLElement> {\n  /**\n   * Добавляет иконку слева.\n   *\n   * - Для `mode=\"default\"` используйте иконки размером 24.\n   * - Для всех остальных `mode` используйте иконки размером 20.\n   */\n  before?: React.ReactNode;\n  /**\n   * Добавляет элемент слева от `after`.\n   *\n   * - `React.ReactElement` – либо [`Badge`](https://vkcom.github.io/VKUI/#/Badge) с параметром `mode=\"prominent\"`.\n   *   либо [`Counter`](https://vkcom.github.io/VKUI/#/Counter) с параметрами `mode=\"prominent\" size=\"s\"`.\n   * - `number` – для показа текстового блока с переданным числом.\n   */\n  status?: React.ReactElement | number;\n  /**\n   * Добавляет иконку справа.\n   *\n   * Например, `<Icon16Dropdown />`\n   */\n  after?: React.ReactNode;\n  selected?: boolean;\n  disabled?: boolean;\n}\n\nconst warn = warnOnce('TabsItem');\n\n/**\n * @see https://vkcom.github.io/VKUI/#/TabsItem\n */\nexport const TabsItem = ({\n  before,\n  children,\n  status,\n  after,\n  selected = false,\n  className,\n  role = 'tab',\n  tabIndex: tabIndexProp,\n  getRootRef,\n  ...restProps\n}: TabsItemProps) => {\n  const { sizeY = 'none' } = useAdaptivity();\n  const {\n    mode,\n    withGaps,\n    layoutFillMode,\n    scrollBehaviorToSelectedTab,\n    withScrollToSelectedTab,\n  }: TabsContextProps = React.useContext(TabsModeContext);\n  let statusComponent = null;\n  const platform = usePlatform();\n\n  const isTabFlow = role === 'tab';\n\n  if (hasReactNode(status)) {\n    statusComponent =\n      typeof status === 'number' ? (\n        <Subhead\n          Component=\"span\"\n          className={classNames(styles['TabsItem__status'], styles['TabsItem__status--count'])}\n          weight=\"2\"\n        >\n          <VisuallyHidden>&nbsp;</VisuallyHidden>\n          {status}\n        </Subhead>\n      ) : (\n        <span className={styles['TabsItem__status']}>\n          <VisuallyHidden>&nbsp;</VisuallyHidden>\n          {status}\n        </span>\n      );\n  }\n\n  if (process.env.NODE_ENV === 'development' && isTabFlow) {\n    if (!restProps['aria-controls']) {\n      warn(`Передайте в \"aria-controls\" id контролируемого блока`, 'warn');\n    } else if (!restProps['id']) {\n      warn(\n        `Передайте \"id\" компоненту для использования в \"aria-labelledby\" контролируемого блока`,\n        'warn',\n      );\n    }\n  }\n\n  let tabIndex = tabIndexProp;\n  if (isTabFlow && tabIndex === undefined) {\n    tabIndex = selected ? 0 : -1;\n  }\n\n  const rootRef = useExternRef(getRootRef);\n\n  const prevSelected = usePrevious(selected);\n  const isInitialRender = prevSelected === undefined;\n  const shouldScrollToSelected =\n    withScrollToSelectedTab && !isInitialRender && prevSelected !== selected && selected;\n\n  const { document } = useDOM();\n  React.useEffect(\n    function scrollToSelectedItem() {\n      if (!shouldScrollToSelected || !rootRef.current || !document) {\n        return;\n      }\n\n      const tabDOMRect = rootRef.current.getBoundingClientRect();\n      const isTabVerticallyOutsideOfViewport =\n        tabDOMRect.top < 0 || tabDOMRect.bottom > document.documentElement.clientHeight;\n\n      /* проверяем, возможен ли вертикальный скролл, а он возможен для scrollIntoView если\n       * элемент вертикально вне зоны видимости */\n      if (isTabVerticallyOutsideOfViewport) {\n        return;\n      }\n\n      /* Не все браузеры поддерживают используемые нами опции. */\n      try {\n        rootRef.current.scrollIntoView({\n          inline: scrollBehaviorToSelectedTab,\n          block: 'nearest',\n          behavior: 'smooth',\n        });\n      } catch {\n        /* Вызывать scrollIntoView с булевым аргументом не следует, потому что это повлечёт\n         * вертикальный скролл.\n         **/\n      }\n    },\n    [rootRef, document, shouldScrollToSelected, scrollBehaviorToSelectedTab],\n  );\n\n  return (\n    <Tappable\n      {...restProps}\n      getRootRef={rootRef}\n      className={classNames(\n        styles['TabsItem'],\n        mode && stylesMode[mode],\n        selected && styles['TabsItem--selected'],\n        sizeY !== SizeType.REGULAR && sizeYClassNames[sizeY],\n        withGaps && styles['TabsItem--withGaps'],\n        layoutFillMode !== 'auto' && fillModeClassNames[layoutFillMode],\n        className,\n      )}\n      hoverMode={platform === Platform.IOS ? '' : styles['TabsItem--hover']}\n      activeMode=\"\"\n      focusVisibleMode=\"inside\"\n      hasActive={false}\n      role={role}\n      aria-selected={selected}\n      tabIndex={tabIndex}\n    >\n      {before && <div className={styles['TabsItem__before']}>{before}</div>}\n      <Headline\n        Component=\"span\"\n        className={styles['TabsItem__label']}\n        level={mode === 'default' ? '1' : '2'}\n        weight=\"2\"\n      >\n        {children}\n      </Headline>\n      {statusComponent}\n      {after && <div className={styles['TabsItem__after']}>{after}</div>}\n      {mode === 'default' && (\n        <div className={styles['TabsItem__underline']} aria-hidden data-selected={selected} />\n      )}\n    </Tappable>\n  );\n};\n"],"names":["TabsItem","sizeYClassNames","none","SizeType","COMPACT","stylesMode","default","accent","secondary","fillModeClassNames","stretched","shrinked","warn","warnOnce","before","children","status","after","selected","className","role","tabIndex","tabIndexProp","getRootRef","restProps","useAdaptivity","sizeY","React","useContext","TabsModeContext","mode","withGaps","layoutFillMode","scrollBehaviorToSelectedTab","withScrollToSelectedTab","statusComponent","platform","usePlatform","isTabFlow","hasReactNode","Subhead","Component","classNames","weight","VisuallyHidden","span","process","env","NODE_ENV","undefined","rootRef","useExternRef","prevSelected","usePrevious","isInitialRender","shouldScrollToSelected","document","useDOM","useEffect","scrollToSelectedItem","current","tabDOMRect","getBoundingClientRect","isTabVerticallyOutsideOfViewport","top","bottom","documentElement","clientHeight","scrollIntoView","inline","block","behavior","Tappable","REGULAR","hoverMode","Platform","IOS","activeMode","focusVisibleMode","hasActive","aria-selected","div","Headline","level","aria-hidden","data-selected"],"mappings":"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"}