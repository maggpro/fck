{"version":3,"sources":["../../../../src/components/PanelHeaderContext/PanelHeaderContext.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { SizeType } from '../../lib/adaptivity';\nimport { useDOM } from '../../lib/dom';\nimport { Platform } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HTMLAttributesWithRootRef } from '../../types';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { FixedLayout } from '../FixedLayout/FixedLayout';\nimport styles from './PanelHeaderContext.module.css';\n\nconst sizeXClassNames = {\n  none: styles['PanelHeaderContext--sizeX-none'],\n  [SizeType.COMPACT]: styles['PanelHeaderContext--sizeX-compact'],\n  [SizeType.REGULAR]: styles['PanelHeaderContext--sizeX-regular'],\n};\n\nexport interface PanelHeaderContextProps extends HTMLAttributesWithRootRef<HTMLDivElement> {\n  opened: boolean;\n  onClose: VoidFunction;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PanelHeaderContext\n */\nexport const PanelHeaderContext = ({\n  children,\n  onClose,\n  opened = false,\n  className,\n  ...restProps\n}: PanelHeaderContextProps) => {\n  const { document } = useDOM();\n  const platform = usePlatform();\n  const [visible, setVisible] = React.useState(opened);\n  const closing = visible && !opened;\n  const { sizeX = 'none' } = useAdaptivity();\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    opened && setVisible(true);\n  }, [opened]);\n\n  useScrollLock(platform !== Platform.VKCOM && opened);\n\n  // start closing on outer click\n  useGlobalEventListener(\n    document,\n    'click',\n    opened &&\n      !closing &&\n      ((event) => {\n        if (elementRef.current && !elementRef.current.contains(event.target as Node)) {\n          event.stopPropagation();\n          onClose();\n        }\n      }),\n    { capture: true },\n  );\n\n  // fallback onAnimationEnd when animationend not supported\n  const onAnimationEnd = () => setVisible(false);\n  const animationFallback = useTimeout(onAnimationEnd, 200);\n  React.useEffect(\n    () => (closing ? animationFallback.set() : animationFallback.clear()),\n    [animationFallback, closing],\n  );\n\n  return (\n    <FixedLayout\n      {...restProps}\n      className={classNames(\n        styles['PanelHeaderContext'],\n        platform === Platform.IOS && styles['PanelHeaderContext--ios'],\n        opened && styles['PanelHeaderContext--opened'],\n        closing && styles['PanelHeaderContext--closing'],\n        sizeXClassNames[sizeX],\n        className,\n      )}\n      vertical=\"top\"\n    >\n      {visible && (\n        <div\n          onClick={(event) => {\n            event.stopPropagation();\n            onClose();\n          }}\n          className={styles['PanelHeaderContext__fade']}\n        />\n      )}\n      <div\n        className={styles['PanelHeaderContext__in']}\n        ref={elementRef}\n        onAnimationEnd={closing ? onAnimationEnd : undefined}\n      >\n        {visible && <div className={styles['PanelHeaderContext__content']}>{children}</div>}\n      </div>\n    </FixedLayout>\n  );\n};\n"],"names":["PanelHeaderContext","sizeXClassNames","none","SizeType","COMPACT","REGULAR","children","onClose","opened","className","restProps","document","useDOM","platform","usePlatform","React","useState","visible","setVisible","closing","useAdaptivity","sizeX","elementRef","useRef","useIsomorphicLayoutEffect","useScrollLock","Platform","VKCOM","useGlobalEventListener","event","current","contains","target","stopPropagation","capture","onAnimationEnd","animationFallback","useTimeout","useEffect","set","clear","FixedLayout","classNames","IOS","vertical","div","onClick","ref","undefined"],"mappings":";;;;+BA6BaA;;;eAAAA;;;;;;;;;+DA7BU;oBACI;6BACG;sCACS;2BACX;0BACD;0BACF;mBACF;wBACE;yCACiB;6BAEZ;2BACF;IAGJ;AAAxB,IAAMC,mBAAkB;IACtBC,IAAI;sBADkB,MAErBC,oBAAQ,CAACC,OAAO,+DAFK,MAGrBD,oBAAQ,CAACE,OAAO,4CAHK;AAcjB,IAAML,qBAAqB;QAChCM,kBAAAA,UACAC,iBAAAA,gCACAC,QAAAA,oCAAS,uBACTC,mBAAAA,WACGC;QAJHJ;QACAC;QACAC;QACAC;;IAGA,IAAM,AAAEE,WAAaC,IAAAA,WAAM,IAAnBD;IACR,IAAME,WAAWC,IAAAA,wBAAW;IAC5B,IAA8BC,qCAAAA,OAAMC,QAAQ,CAACR,aAAtCS,UAAuBF,oBAAdG,aAAcH;IAC9B,IAAMI,UAAUF,WAAW,CAACT;IAC5B,IAA2BY,kBAAAA,IAAAA,4BAAa,4BAAbA,gBAAnBC,OAAAA,0CAAQ;IAChB,IAAMC,aAAaP,OAAMQ,MAAM,CAAiB;IAEhDC,IAAAA,oDAAyB,EAAC;QACxBhB,UAAUU,WAAW;IACvB,GAAG;QAACV;KAAO;IAEXiB,IAAAA,4BAAa,EAACZ,aAAaa,kBAAQ,CAACC,KAAK,IAAInB;IAE7C,+BAA+B;IAC/BoB,IAAAA,8CAAsB,EACpBjB,UACA,SACAH,UACE,CAACW,WACA,SAACU;QACA,IAAIP,WAAWQ,OAAO,IAAI,CAACR,WAAWQ,OAAO,CAACC,QAAQ,CAACF,MAAMG,MAAM,GAAW;YAC5EH,MAAMI,eAAe;YACrB1B;QACF;IACF,GACF;QAAE2B,SAAS;IAAK;IAGlB,0DAA0D;IAC1D,IAAMC,iBAAiB;eAAMjB,WAAW;;IACxC,IAAMkB,oBAAoBC,IAAAA,sBAAU,EAACF,gBAAgB;IACrDpB,OAAMuB,SAAS,CACb;eAAOnB,UAAUiB,kBAAkBG,GAAG,KAAKH,kBAAkBI,KAAK;OAClE;QAACJ;QAAmBjB;KAAQ;IAG9B,qBACE,qBAACsB,wBAAW,8CACN/B;QACJD,WAAWiC,IAAAA,gBAAU,4BAEnB7B,aAAaa,kBAAQ,CAACiB,GAAG,mCACzBnC,4CACAW,8CACAlB,eAAe,CAACoB,MAAM,EACtBZ;QAEFmC,UAAS;QAER3B,yBACC,qBAAC4B;QACCC,SAAS,SAACjB;YACRA,MAAMI,eAAe;YACrB1B;QACF;QACAE,SAAS;sBAGb,qBAACoC;QACCpC,SAAS;QACTsC,KAAKzB;QACLa,gBAAgBhB,UAAUgB,iBAAiBa;OAE1C/B,yBAAW,qBAAC4B;QAAIpC,SAAS;OAA0CH;AAI5E"}