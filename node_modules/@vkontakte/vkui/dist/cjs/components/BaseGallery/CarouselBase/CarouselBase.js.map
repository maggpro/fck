{"version":3,"sources":["../../../../../src/components/BaseGallery/CarouselBase/CarouselBase.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivityHasPointer } from '../../../hooks/useAdaptivityHasPointer';\nimport { useExternRef } from '../../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../../hooks/useGlobalEventListener';\nimport { useDOM } from '../../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../../lib/warnOnce';\nimport { RootComponent } from '../../RootComponent/RootComponent';\nimport { ScrollArrow } from '../../ScrollArrow/ScrollArrow';\nimport { Touch, TouchEvent } from '../../Touch/Touch';\nimport { BaseGalleryProps, GallerySlidesState } from '../types';\nimport { ANIMATION_DURATION, CONTROL_ELEMENTS_STATE, SLIDES_MANAGER_STATE } from './constants';\nimport { calculateIndent, getLoopPoints, getTargetIndex } from './helpers';\nimport { useSlideAnimation } from './hooks';\nimport { ControlElementsState, SlidesManagerState } from './types';\nimport styles from '../BaseGallery.module.css';\n\nconst stylesBullets = {\n  dark: styles['BaseGallery__bullets--dark'],\n  light: styles['BaseGallery__bullets--light'],\n};\n\nconst warn = warnOnce('Gallery');\n\nexport const CarouselBase = ({\n  bullets = false,\n  getRootRef,\n  children,\n  slideWidth = '100%',\n  slideIndex = 0,\n  isDraggable: isDraggableProp = true,\n  onDragStart,\n  onDragEnd,\n  onChange,\n  onPrevClick,\n  onNextClick,\n  align = 'left',\n  showArrows,\n  getRef,\n  arrowSize = 'l',\n  ...restProps\n}: BaseGalleryProps) => {\n  const slidesStore = React.useRef<Record<string, HTMLDivElement | null>>({});\n  const slidesManager = React.useRef<SlidesManagerState>(SLIDES_MANAGER_STATE);\n\n  const rootRef = useExternRef(getRootRef);\n  const viewportRef = useExternRef(getRef);\n  const layerRef = React.useRef<HTMLDivElement>(null);\n  const animationFrameRef = React.useRef<ReturnType<typeof requestAnimationFrame> | null>(null);\n  const shiftXCurrentRef = React.useRef<number>(0);\n  const shiftXDeltaRef = React.useRef<number>(0);\n  const initialized = React.useRef<boolean>(false);\n  const { addToAnimationQueue, getAnimateFunction, startAnimation } = useSlideAnimation();\n\n  const [controlElementsState, setControlElementsState] =\n    React.useState<ControlElementsState>(CONTROL_ELEMENTS_STATE);\n\n  const { window } = useDOM();\n  const hasPointer = useAdaptivityHasPointer();\n\n  const isCenterWithCustomWidth = slideWidth === 'custom' && align === 'center';\n\n  const transformCssStyles = (shiftX: number, animation = false) => {\n    slidesManager.current.loopPoints.forEach((loopPoint) => {\n      const { target, index } = loopPoint;\n      const slide = slidesStore.current[index];\n      if (slide) {\n        slide.style.transform = `translate3d(${target(shiftX)}px, 0, 0)`;\n      }\n    });\n\n    if (layerRef.current) {\n      layerRef.current.style.transform = `translate3d(${shiftX}px, 0, 0)`;\n      layerRef.current.style.transition = animation\n        ? `transform ${ANIMATION_DURATION}ms cubic-bezier(.1, 0, .25, 1)`\n        : '';\n    }\n  };\n\n  const requestTransform = (shiftX: number, animation = false) => {\n    const { snaps, contentSize, slides } = slidesManager.current;\n\n    if (animationFrameRef.current !== null) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    animationFrameRef.current = requestAnimationFrame(() => {\n      if (shiftX > snaps[0]) {\n        shiftXCurrentRef.current = -contentSize + snaps[0];\n        shiftX = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      }\n      const lastPoint = slides[slides.length - 1].width + slides[slides.length - 1].coordX;\n\n      if (shiftX <= -lastPoint) {\n        shiftXCurrentRef.current = Math.abs(shiftXDeltaRef.current) + snaps[0];\n      }\n      transformCssStyles(shiftX, animation);\n    });\n  };\n\n  const initializeSlides = () => {\n    if (!rootRef.current || !viewportRef.current) {\n      return;\n    }\n    let localSlides =\n      React.Children.map(children, (_item, i): GallerySlidesState => {\n        const elem = slidesStore.current[i] || { offsetLeft: 0, offsetWidth: 0 };\n        return { coordX: elem.offsetLeft, width: elem.offsetWidth };\n      }) || [];\n\n    const containerWidth = rootRef.current.offsetWidth;\n    const viewportOffsetWidth = viewportRef.current.offsetWidth;\n    const layerWidth = localSlides.reduce((val, slide) => slide.width + val, 0);\n\n    if (process.env.NODE_ENV === 'development') {\n      let remainingWidth = containerWidth;\n      let slideIndex = 0;\n\n      while (remainingWidth > 0 && slideIndex < localSlides.length) {\n        remainingWidth -= localSlides[slideIndex].width;\n        slideIndex++;\n      }\n      if (remainingWidth <= 0 && slideIndex === localSlides.length) {\n        warn(\n          'Ширины слайдов недостаточно для корректной работы свойства \"looped\". Пожалуйста, сделайте её больше.\"',\n        );\n      }\n    }\n    if (align === 'center') {\n      const firstSlideShift = (containerWidth - localSlides[0].width) / 2;\n      localSlides = localSlides.map((item) => {\n        return {\n          width: item.width,\n          coordX: item.coordX - firstSlideShift,\n        };\n      });\n    }\n\n    slidesManager.current = {\n      ...slidesManager.current,\n      viewportOffsetWidth,\n      slides: localSlides,\n      isFullyVisible: layerWidth <= containerWidth,\n    };\n\n    const snaps = localSlides.map((_, index) =>\n      calculateIndent(index, slidesManager.current, isCenterWithCustomWidth),\n    );\n\n    let contentSize = -snaps[snaps.length - 1] + localSlides[localSlides.length - 1].width;\n    if (align === 'center') {\n      contentSize += snaps[0];\n    }\n\n    slidesManager.current.snaps = snaps;\n    slidesManager.current.contentSize = contentSize;\n    slidesManager.current.loopPoints = getLoopPoints(slidesManager.current, containerWidth);\n\n    setControlElementsState({\n      canSlideLeft: !slidesManager.current.isFullyVisible,\n      canSlideRight: !slidesManager.current.isFullyVisible,\n      isDraggable: isDraggableProp && !slidesManager.current.isFullyVisible,\n    });\n\n    shiftXCurrentRef.current = snaps[slideIndex];\n    initialized.current = true;\n\n    requestTransform(shiftXCurrentRef.current);\n  };\n\n  const onResize = () => {\n    if (initialized.current) {\n      initializeSlides();\n    }\n  };\n\n  useGlobalEventListener(window, 'resize', onResize);\n\n  useIsomorphicLayoutEffect(\n    function performSlideChange() {\n      if (!initialized.current) {\n        return;\n      }\n      const { snaps, slides } = slidesManager.current;\n      const indent = snaps[slideIndex];\n      let startPoint = shiftXCurrentRef.current;\n\n      /**\n       * Переключаемся с последнего элемента на первый\n       * Для корректной анимации мы прокручиваем последний слайд на всю длину (shiftX) \"вперед\"\n       * В конце анимации при отрисовке следующего кадра задаем всем слайдам начальные значения\n       */\n      if (indent === snaps[0] && shiftXCurrentRef.current <= snaps[snaps.length - 1]) {\n        const distance =\n          Math.abs(snaps[snaps.length - 1]) + slides[slides.length - 1].width + startPoint;\n\n        addToAnimationQueue(\n          getAnimateFunction((progress) => {\n            const shiftX = startPoint + progress * distance * -1;\n\n            transformCssStyles(shiftX);\n\n            if (shiftX <= snaps[snaps.length - 1] - slides[slides.length - 1].width) {\n              requestAnimationFrame(() => {\n                shiftXCurrentRef.current = indent;\n                transformCssStyles(snaps[0]);\n              });\n            }\n          }),\n        );\n        /**\n         * Переключаемся с первого слайда на последний\n         * Для корректной анимации сначала задаем первым видимым слайдам смещение\n         * В следующем кадре начинаем анимация прокрутки \"назад\"\n         */\n      } else if (indent === snaps[snaps.length - 1] && shiftXCurrentRef.current === snaps[0]) {\n        startPoint = indent - slides[slides.length - 1].width;\n\n        addToAnimationQueue(() => {\n          requestAnimationFrame(() => {\n            const shiftX = indent - slides[slides.length - 1].width;\n            transformCssStyles(shiftX);\n\n            getAnimateFunction((progress) => {\n              transformCssStyles(startPoint + progress * slides[slides.length - 1].width);\n            })();\n          });\n        });\n        /**\n         * Если не обработаны `corner`-кейсы выше, то просто проигрываем анимацию смещения\n         */\n      } else {\n        addToAnimationQueue(() => {\n          const distance = Math.abs(indent - startPoint);\n          let direction = startPoint <= indent ? 1 : -1;\n\n          getAnimateFunction((progress) => {\n            const shiftX = startPoint + progress * distance * direction;\n            transformCssStyles(shiftX);\n          })();\n        });\n      }\n\n      startAnimation();\n\n      shiftXCurrentRef.current = indent;\n    },\n    [slideIndex],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    initializeSlides();\n  }, [children, align, slideWidth]);\n\n  const slideLeft = (event: React.MouseEvent) => {\n    onChange?.(\n      (slideIndex - 1 + slidesManager.current.slides.length) % slidesManager.current.slides.length,\n    );\n    onPrevClick?.(event);\n  };\n\n  const slideRight = (event: React.MouseEvent) => {\n    onChange?.((slideIndex + 1) % slidesManager.current.slides.length);\n    onNextClick?.(event);\n  };\n\n  const onStart = (e: TouchEvent) => {\n    e.originalEvent.stopPropagation();\n    onDragStart?.(e);\n    shiftXCurrentRef.current = slidesManager.current.snaps[slideIndex];\n    shiftXDeltaRef.current = 0;\n  };\n\n  const onMoveX = (e: TouchEvent) => {\n    if (isDraggableProp && !slidesManager.current.isFullyVisible) {\n      e.originalEvent.preventDefault();\n\n      if (e.isSlideX) {\n        if (shiftXDeltaRef.current !== e.shiftX) {\n          shiftXDeltaRef.current = e.shiftX;\n          requestTransform(shiftXCurrentRef.current + shiftXDeltaRef.current);\n        }\n      }\n    }\n  };\n\n  const onEnd = (e: TouchEvent) => {\n    let targetIndex = slideIndex;\n    if (e.isSlide) {\n      targetIndex = getTargetIndex(\n        slidesManager.current.slides,\n        slideIndex,\n        shiftXCurrentRef.current,\n        shiftXDeltaRef.current,\n      );\n    }\n    onDragEnd?.(e, targetIndex);\n\n    if (targetIndex !== slideIndex) {\n      shiftXCurrentRef.current = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      onChange?.(targetIndex);\n    } else {\n      const initialShiftX = slidesManager.current.snaps[targetIndex];\n      requestTransform(initialShiftX, true);\n    }\n  };\n\n  const setSlideRef = (slideRef: HTMLDivElement | null, slideIndex: number) => {\n    slidesStore.current[slideIndex] = slideRef;\n  };\n\n  const { canSlideLeft, canSlideRight, isDraggable } = controlElementsState;\n\n  return (\n    <RootComponent\n      {...restProps}\n      baseClassName={classNames(\n        styles['BaseGallery'],\n        slideWidth === 'custom' && styles['BaseGallery--custom-width'],\n        isDraggable && styles['BaseGallery--draggable'],\n      )}\n      getRootRef={rootRef}\n    >\n      <Touch\n        className={styles['BaseGallery__viewport']}\n        onStartX={onStart}\n        onMoveX={onMoveX}\n        onEnd={onEnd}\n        style={{ width: slideWidth === 'custom' ? '100%' : slideWidth }}\n        getRootRef={viewportRef}\n        noSlideClick\n      >\n        <div className={styles['BaseGallery__layer']} ref={layerRef}>\n          {React.Children.map(children, (item: React.ReactNode, i: number) => (\n            <div\n              className={styles['BaseGallery__slide']}\n              key={`slide-${i}`}\n              ref={(el) => setSlideRef(el, i)}\n            >\n              {item}\n            </div>\n          ))}\n        </div>\n      </Touch>\n\n      {bullets && (\n        <div\n          aria-hidden\n          className={classNames(styles['BaseGallery__bullets'], stylesBullets[bullets])}\n        >\n          {React.Children.map(children, (_item: React.ReactNode, index: number) => (\n            <div\n              className={classNames(\n                styles['BaseGallery__bullet'],\n                index === slideIndex && styles['BaseGallery__bullet--active'],\n              )}\n              key={index}\n            />\n          ))}\n        </div>\n      )}\n\n      {showArrows && hasPointer && canSlideLeft && (\n        <ScrollArrow\n          className={styles['BaseGallery__arrow']}\n          direction=\"left\"\n          onClick={slideLeft}\n          size={arrowSize}\n        />\n      )}\n      {showArrows && hasPointer && canSlideRight && (\n        <ScrollArrow\n          className={styles['BaseGallery__arrow']}\n          direction=\"right\"\n          onClick={slideRight}\n          size={arrowSize}\n        />\n      )}\n    </RootComponent>\n  );\n};\n"],"names":["CarouselBase","stylesBullets","dark","light","warn","warnOnce","bullets","getRootRef","children","slideWidth","slideIndex","isDraggableProp","isDraggable","onDragStart","onDragEnd","onChange","onPrevClick","onNextClick","align","showArrows","getRef","arrowSize","restProps","slidesStore","React","useRef","slidesManager","SLIDES_MANAGER_STATE","rootRef","useExternRef","viewportRef","layerRef","animationFrameRef","shiftXCurrentRef","shiftXDeltaRef","initialized","useSlideAnimation","addToAnimationQueue","getAnimateFunction","startAnimation","useState","CONTROL_ELEMENTS_STATE","controlElementsState","setControlElementsState","window","useDOM","hasPointer","useAdaptivityHasPointer","isCenterWithCustomWidth","transformCssStyles","shiftX","animation","current","loopPoints","forEach","loopPoint","target","index","slide","style","transform","transition","ANIMATION_DURATION","requestTransform","snaps","contentSize","slides","cancelAnimationFrame","requestAnimationFrame","lastPoint","length","width","coordX","Math","abs","initializeSlides","localSlides","Children","map","_item","i","elem","offsetLeft","offsetWidth","containerWidth","viewportOffsetWidth","layerWidth","reduce","val","process","env","NODE_ENV","remainingWidth","firstSlideShift","item","isFullyVisible","_","calculateIndent","getLoopPoints","canSlideLeft","canSlideRight","onResize","useGlobalEventListener","useIsomorphicLayoutEffect","performSlideChange","indent","startPoint","distance","progress","direction","slideLeft","event","slideRight","onStart","e","originalEvent","stopPropagation","onMoveX","preventDefault","isSlideX","onEnd","targetIndex","isSlide","getTargetIndex","initialShiftX","setSlideRef","slideRef","RootComponent","baseClassName","classNames","Touch","className","onStartX","noSlideClick","div","ref","key","el","aria-hidden","ScrollArrow","onClick","size"],"mappings":"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"}