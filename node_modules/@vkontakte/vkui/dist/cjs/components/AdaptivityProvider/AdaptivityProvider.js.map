{"version":3,"sources":["../../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"sourcesContent":["import * as React from 'react';\nimport { hasMouse as _hasPointer } from '@vkontakte/vkjs';\nimport { BridgeAdaptivity, useBridgeAdaptivity } from '../../hooks/useBridgeAdaptivity';\nimport {\n  BREAKPOINTS,\n  getSizeX,\n  isCompactByViewHeight,\n  isCompactByViewWidth,\n  SizeType,\n  ViewHeight,\n  ViewWidth,\n} from '../../lib/adaptivity';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { HasChildren } from '../../types';\nimport { AdaptivityContext, type AdaptivityProps } from './AdaptivityContext';\n\nconst warn = warnOnce('AdaptivityProvider');\n\nexport interface AdaptivityProviderProps extends AdaptivityProps, HasChildren {}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AdaptivityProvider\n */\nexport const AdaptivityProvider = ({\n  viewWidth,\n  viewHeight,\n  sizeX,\n  sizeY,\n  hasPointer,\n  hasHover,\n  children,\n}: AdaptivityProviderProps) => {\n  // TODO [>=6]: удалить использование хука (#5049)\n  /* eslint-disable @typescript-eslint/naming-convention */\n  const LEGACY_isPerhapsPropsByBridgeTypeAdaptive =\n    viewWidth !== undefined && viewHeight !== undefined;\n  const LEGACY_isPerhapsPropsByBridgeTypeForceMobile =\n    viewWidth !== undefined && sizeX !== undefined && sizeY !== undefined;\n  const LEGACY_disableInternalUseBridgeAdaptivity =\n    LEGACY_isPerhapsPropsByBridgeTypeAdaptive || LEGACY_isPerhapsPropsByBridgeTypeForceMobile;\n  const LEGACY_bridge = useBridgeAdaptivity(LEGACY_disableInternalUseBridgeAdaptivity);\n  /* eslint-enable @typescript-eslint/naming-convention */\n\n  if (process.env.NODE_ENV === 'development') {\n    // TODO [>=6]: удалить warn\n    if (!LEGACY_disableInternalUseBridgeAdaptivity) {\n      warn(\"[@vkontakte/vk-bridge] Интеграция VKUI с @vkontakte/vk-bridge устарела и будет удалена в v6. Используйте хук `useAdaptivity()` из @vkontakte/vk-bridge-react и результат передайте в компонент (см. https://github.com/VKCOM/VKUI/issues/5049)\"); // prettier-ignore\n    }\n  }\n\n  const adaptivity = React.useMemo(\n    () =>\n      calculateAdaptivity(\n        {\n          viewWidth,\n          viewHeight,\n          sizeX,\n          sizeY,\n          hasPointer,\n          hasHover,\n        },\n        LEGACY_bridge,\n      ),\n    [viewWidth, viewHeight, sizeX, sizeY, hasPointer, hasHover, LEGACY_bridge],\n  );\n\n  return <AdaptivityContext.Provider value={adaptivity}>{children}</AdaptivityContext.Provider>;\n};\n\nfunction calculateAdaptivity(\n  { viewWidth, viewHeight, sizeX, sizeY, hasPointer, hasHover }: AdaptivityProps,\n  LEGACY_bridge: BridgeAdaptivity, // eslint-disable-line @typescript-eslint/naming-convention\n) {\n  // TODO [>=6]: удалить блок кода c использованием LEGACY_bridge (#5049)\n  //  https://github.com/VKCOM/VKUI/blob/v5.5.5/packages/vkui/src/components/AdaptivityProvider/AdaptivityProvider.tsx#L46-L92\n  if (LEGACY_bridge.type === 'adaptive') {\n    const { viewportWidth, viewportHeight } = LEGACY_bridge;\n\n    if (viewportWidth >= BREAKPOINTS.DESKTOP) {\n      viewWidth = ViewWidth.DESKTOP;\n    } else if (viewportWidth >= BREAKPOINTS.TABLET) {\n      viewWidth = ViewWidth.TABLET;\n    } else if (viewportWidth >= BREAKPOINTS.SMALL_TABLET) {\n      viewWidth = ViewWidth.SMALL_TABLET;\n    } else if (viewportWidth >= BREAKPOINTS.MOBILE) {\n      viewWidth = ViewWidth.MOBILE;\n    } else {\n      viewWidth = ViewWidth.SMALL_MOBILE;\n    }\n\n    if (viewportHeight >= BREAKPOINTS.MEDIUM_HEIGHT) {\n      viewHeight = ViewHeight.MEDIUM;\n    } else if (viewportHeight >= BREAKPOINTS.MOBILE_LANDSCAPE_HEIGHT) {\n      viewHeight = ViewHeight.SMALL;\n    } else {\n      viewHeight = ViewHeight.EXTRA_SMALL;\n    }\n\n    if (viewWidth <= ViewWidth.MOBILE) {\n      sizeX = SizeType.COMPACT;\n    } else {\n      sizeX = SizeType.REGULAR;\n    }\n\n    if (\n      (viewWidth >= ViewWidth.SMALL_TABLET && _hasPointer) ||\n      viewHeight <= ViewHeight.EXTRA_SMALL\n    ) {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  } else if (\n    LEGACY_bridge.type === 'force_mobile' ||\n    LEGACY_bridge.type === 'force_mobile_compact'\n  ) {\n    viewWidth = ViewWidth.MOBILE;\n    sizeX = SizeType.COMPACT;\n\n    if (LEGACY_bridge.type === 'force_mobile_compact') {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  } else {\n    if (sizeX === undefined && viewWidth !== undefined) {\n      sizeX = getSizeX(viewWidth);\n    }\n\n    if (sizeY === undefined) {\n      if (isCompactByViewWidth(viewWidth, hasPointer) || isCompactByViewHeight(viewHeight)) {\n        sizeY = SizeType.COMPACT;\n      } else if (viewWidth !== undefined || viewHeight !== undefined) {\n        sizeY = SizeType.REGULAR;\n      }\n    }\n  }\n\n  return {\n    viewWidth,\n    viewHeight,\n    sizeX,\n    sizeY,\n    hasPointer,\n    hasHover,\n  };\n}\n"],"names":["AdaptivityProvider","warn","warnOnce","viewWidth","viewHeight","sizeX","sizeY","hasPointer","hasHover","children","LEGACY_isPerhapsPropsByBridgeTypeAdaptive","undefined","LEGACY_isPerhapsPropsByBridgeTypeForceMobile","LEGACY_disableInternalUseBridgeAdaptivity","LEGACY_bridge","useBridgeAdaptivity","process","env","NODE_ENV","adaptivity","React","useMemo","calculateAdaptivity","AdaptivityContext","Provider","value","type","viewportWidth","viewportHeight","BREAKPOINTS","DESKTOP","ViewWidth","TABLET","SMALL_TABLET","MOBILE","SMALL_MOBILE","MEDIUM_HEIGHT","ViewHeight","MEDIUM","MOBILE_LANDSCAPE_HEIGHT","SMALL","EXTRA_SMALL","SizeType","COMPACT","REGULAR","_hasPointer","getSizeX","isCompactByViewWidth","isCompactByViewHeight"],"mappings":"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"}