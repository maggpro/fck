{"version":3,"sources":["../../../../src/lib/floating/adapters.ts"],"sourcesContent":["import {\n  autoUpdate as autoUpdateLib,\n  type AutoUpdateOptions,\n  type FloatingElement,\n  type ReferenceType,\n} from '@vkontakte/vkui-floating-ui/react-dom';\n\nconst defaultOptions = {\n  ancestorScroll: true,\n  ancestorResize: true,\n  // По умолчанию отключаем, т.к. навешивать `MutationObserver` может быть дорого.\n  // В `autoUpdateLib` по умолчанию опция включена. Там используется ResizeObserver, но и он не менее дорогостоящий.\n  // https://github.com/floating-ui/floating-ui/blob/0a34fe9cc2c7483976785a71bd0777cd7c3f2a6a/packages/dom/src/autoUpdate.ts#L6-L33\n  elementResize: false,\n  animationFrame: false,\n};\n\nexport function autoUpdateFloatingElement(\n  reference: ReferenceType,\n  floating: FloatingElement,\n  update: () => void,\n  options: Partial<AutoUpdateOptions> = defaultOptions,\n): ReturnType<typeof autoUpdateLib> {\n  const { elementResize = false, ...restOptions } = options;\n\n  const autoUpdateLibDisposer = autoUpdateLib(reference, floating, update, {\n    ...restOptions,\n    // Отключаем в библиотеке, т.к. под капотом используется `ResizeObserver`, которое не покрывается нашим `browserlist`.\n    // Вместо него мы используем `MutationObserver`.\n    // https://caniuse.com/resizeobserver\n    elementResize: false,\n  });\n\n  // В случае если `ResizeObserver` будет полифилиться или он будет покрываться нашим `browserlist`, то надо удалить\n  // код с `MutationObserver`.\n  let observer: MutationObserver | null = null;\n  if (elementResize) {\n    observer = new MutationObserver(update);\n\n    if (reference instanceof Element) {\n      observer.observe(reference, {\n        childList: true,\n        subtree: true,\n      });\n    }\n\n    observer.observe(floating, {\n      childList: true,\n      subtree: true,\n    });\n  }\n\n  return () => {\n    if (observer !== null) {\n      observer.disconnect();\n      observer = null;\n    }\n    autoUpdateLibDisposer();\n  };\n}\n"],"names":["autoUpdateFloatingElement","defaultOptions","ancestorScroll","ancestorResize","elementResize","animationFrame","reference","floating","update","options","restOptions","autoUpdateLibDisposer","autoUpdateLib","observer","MutationObserver","Element","observe","childList","subtree","disconnect"],"mappings":";;;;+BAiBgBA;;;eAAAA;;;;;;;wBAZT;AAEP,IAAMC,iBAAiB;IACrBC,gBAAgB;IAChBC,gBAAgB;IAChB,gFAAgF;IAChF,kHAAkH;IAClH,iIAAiI;IACjIC,eAAe;IACfC,gBAAgB;AAClB;AAEO,SAASL,0BACdM,SAAwB,EACxBC,QAAyB,EACzBC,MAAkB;QAClBC,UAAAA,iEAAsCR;IAEtC,6BAAkDQ,QAA1CL,eAAAA,oDAAgB,gCAAUM,2CAAgBD;QAA1CL;;IAER,IAAMO,wBAAwBC,IAAAA,oBAAa,EAACN,WAAWC,UAAUC,QAAQ,4CACpEE;QACH,sHAAsH;QACtH,gDAAgD;QAChD,qCAAqC;QACrCN,eAAe;;IAGjB,kHAAkH;IAClH,4BAA4B;IAC5B,IAAIS,WAAoC;IACxC,IAAIT,eAAe;QACjBS,WAAW,IAAIC,iBAAiBN;QAEhC,IAAIF,AAAS,aAAYS,CAArBT,WAAqBS,UAAS;YAChCF,SAASG,OAAO,CAACV,WAAW;gBAC1BW,WAAW;gBACXC,SAAS;YACX;QACF;QAEAL,SAASG,OAAO,CAACT,UAAU;YACzBU,WAAW;YACXC,SAAS;QACX;IACF;IAEA,OAAO;QACL,IAAIL,aAAa,MAAM;YACrBA,SAASM,UAAU;YACnBN,WAAW;QACb;QACAF;IACF;AACF"}