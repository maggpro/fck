{"version":3,"sources":["../../../src/hooks/useInsets.ts"],"sourcesContent":["import * as React from 'react';\nimport vkBridge, { Insets as BridgeInsets } from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\nexport interface Insets {\n  bottom: BridgeInsets['bottom'] | null;\n  top: BridgeInsets['top'] | null;\n  left: BridgeInsets['left'] | null;\n  right: BridgeInsets['right'] | null;\n}\n\nlet initialState: Insets = {\n  bottom: null,\n  top: null,\n  left: null,\n  right: null,\n};\n\ninterface BridgeEvent {\n  detail: {\n    type: string;\n    data: {\n      [index: string]: any;\n    };\n  };\n}\n\nfunction resolveInsets(e: BridgeEvent): Insets | null {\n  const { type, data } = e.detail;\n  switch (type) {\n    case 'VKWebAppUpdateConfig':\n    case 'VKWebAppUpdateInsets': // Устаревшее событие vk-bridge\n      const { insets } = data;\n      if (insets) {\n        return {\n          ...insets,\n          bottom: insets.bottom > 150 ? 0 : insets.bottom, // если больше 150 – значит открылась клава и она сама работает как инсет, то есть наш нужно занулить\n        };\n      }\n  }\n  return null;\n}\n\n/**\n * TODO [>=6]: удалить хук (#5049)\n * @deprecated v5.8.0\n */\nexport function useInsets(disabled = false): Insets {\n  const [insets, setInsets] = React.useState<Insets>(initialState);\n\n  useIsomorphicLayoutEffect(() => {\n    if (disabled) {\n      return;\n    }\n\n    const handleBridgeEvent = (event: BridgeEvent) => {\n      const insets = resolveInsets(event);\n      if (insets) {\n        setInsets(insets);\n      }\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, [disabled]);\n\n  return insets;\n}\n"],"names":["React","vkBridge","useIsomorphicLayoutEffect","initialState","bottom","top","left","right","resolveInsets","e","type","data","detail","insets","useInsets","disabled","setInsets","useState","handleBridgeEvent","event","subscribe","unsubscribe"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,OAAOC,cAA0C,uBAAuB;AACxE,SAASC,yBAAyB,QAAQ,mCAAmC;AAS7E,IAAIC,eAAuB;IACzBC,QAAQ;IACRC,KAAK;IACLC,MAAM;IACNC,OAAO;AACT;AAWA,SAASC,cAAcC,CAAc;IACnC,MAAM,EAAEC,IAAI,EAAEC,IAAI,EAAE,GAAGF,EAAEG,MAAM;IAC/B,OAAQF;QACN,KAAK;QACL,KAAK;YACH,MAAM,EAAEG,MAAM,EAAE,GAAGF;YACnB,IAAIE,QAAQ;gBACV,OAAO;oBACL,GAAGA,MAAM;oBACTT,QAAQS,OAAOT,MAAM,GAAG,MAAM,IAAIS,OAAOT,MAAM;gBACjD;YACF;IACJ;IACA,OAAO;AACT;AAEA;;;CAGC,GACD,OAAO,SAASU,UAAUC,WAAW,KAAK;IACxC,MAAM,CAACF,QAAQG,UAAU,GAAGhB,MAAMiB,QAAQ,CAASd;IAEnDD,0BAA0B;QACxB,IAAIa,UAAU;YACZ;QACF;QAEA,MAAMG,oBAAoB,CAACC;YACzB,MAAMN,SAASL,cAAcW;YAC7B,IAAIN,QAAQ;gBACVG,UAAUH;YACZ;QACF;QAEAZ,SAASmB,SAAS,CAACF;QACnB,OAAO;YACLjB,SAASoB,WAAW,CAACH;QACvB;IACF,GAAG;QAACH;KAAS;IAEb,OAAOF;AACT"}