{"version":3,"sources":["../../../src/lib/platform.ts"],"sourcesContent":["import { querystring } from '@vkontakte/vkjs';\nimport { LiteralUnion } from '../types';\nimport { BrowserInfo, computeBrowserInfo } from './browser';\nimport { canUseDOM } from './dom';\n\nexport enum Platform {\n  ANDROID = 'android',\n  IOS = 'ios',\n  VKCOM = 'vkcom',\n}\n\n/**\n * TODO [>=6]: удалить из VKUI\n *\n * Значение, которое передаётся в качестве query-параметра при открытии VK Mini Apps\n * @see {@link https://dev.vk.com/mini-apps/development/launch-params#vk_platform vk_platform}\n *\n * @deprecated v5.8.0\n */\nfunction getPlatformByQueryString(queryString: string): Platform | undefined {\n  const PLATFORM_ALIAS = { desktop_web: Platform.VKCOM };\n  const isPlatformAlias = (platformAlias: string): platformAlias is keyof typeof PLATFORM_ALIAS =>\n    platformAlias in PLATFORM_ALIAS;\n  try {\n    const parsedQuery = querystring.parse(queryString);\n    const platformAliasByQuery = parsedQuery['vk_platform'];\n    return typeof platformAliasByQuery === 'string' && isPlatformAlias(platformAliasByQuery)\n      ? PLATFORM_ALIAS[platformAliasByQuery]\n      : undefined;\n  } catch (e) {\n    console.warn(e);\n    return;\n  }\n}\n\nconst platformByQueryString = canUseDOM ? getPlatformByQueryString(location.search) : undefined;\n\nexport type PlatformType = LiteralUnion<'android' | 'ios' | 'vkcom', string>;\n\nexport function platform(browserInfo?: BrowserInfo): PlatformType {\n  if (platformByQueryString) {\n    return platformByQueryString;\n  }\n\n  if (!browserInfo) {\n    browserInfo = computeBrowserInfo();\n  }\n\n  return browserInfo.system === 'ios' ? Platform.IOS : Platform.ANDROID;\n}\n"],"names":["querystring","computeBrowserInfo","canUseDOM","Platform","getPlatformByQueryString","queryString","PLATFORM_ALIAS","desktop_web","isPlatformAlias","platformAlias","parsedQuery","parse","platformAliasByQuery","undefined","e","console","warn","platformByQueryString","location","search","platform","browserInfo","system"],"mappings":"AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAE9C,SAAsBC,kBAAkB,QAAQ,YAAY;AAC5D,SAASC,SAAS,QAAQ,QAAQ;;UAEtBC;;;;GAAAA,aAAAA;AAMZ;;;;;;;CAOC,GACD,SAASC,yBAAyBC,WAAmB;IACnD,MAAMC,iBAAiB;QAAEC,WAAW;IAAiB;IACrD,MAAMC,kBAAkB,CAACC,gBACvBA,iBAAiBH;IACnB,IAAI;QACF,MAAMI,cAAcV,YAAYW,KAAK,CAACN;QACtC,MAAMO,uBAAuBF,WAAW,CAAC,cAAc;QACvD,OAAO,OAAOE,yBAAyB,YAAYJ,gBAAgBI,wBAC/DN,cAAc,CAACM,qBAAqB,GACpCC;IACN,EAAE,OAAOC,GAAG;QACVC,QAAQC,IAAI,CAACF;QACb;IACF;AACF;AAEA,MAAMG,wBAAwBf,YAAYE,yBAAyBc,SAASC,MAAM,IAAIN;AAItF,OAAO,SAASO,SAASC,WAAyB;IAChD,IAAIJ,uBAAuB;QACzB,OAAOA;IACT;IAEA,IAAI,CAACI,aAAa;QAChBA,cAAcpB;IAChB;IAEA,OAAOoB,YAAYC,MAAM,KAAK;AAChC"}