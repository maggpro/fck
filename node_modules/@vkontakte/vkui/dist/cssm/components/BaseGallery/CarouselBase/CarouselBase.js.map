{"version":3,"sources":["../../../../../src/components/BaseGallery/CarouselBase/CarouselBase.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivityHasPointer } from '../../../hooks/useAdaptivityHasPointer';\nimport { useExternRef } from '../../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../../hooks/useGlobalEventListener';\nimport { useDOM } from '../../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../../lib/warnOnce';\nimport { RootComponent } from '../../RootComponent/RootComponent';\nimport { ScrollArrow } from '../../ScrollArrow/ScrollArrow';\nimport { Touch, TouchEvent } from '../../Touch/Touch';\nimport { BaseGalleryProps, GallerySlidesState } from '../types';\nimport { ANIMATION_DURATION, CONTROL_ELEMENTS_STATE, SLIDES_MANAGER_STATE } from './constants';\nimport { calculateIndent, getLoopPoints, getTargetIndex } from './helpers';\nimport { useSlideAnimation } from './hooks';\nimport { ControlElementsState, SlidesManagerState } from './types';\nimport styles from '../BaseGallery.module.css';\n\nconst stylesBullets = {\n  dark: styles['BaseGallery__bullets--dark'],\n  light: styles['BaseGallery__bullets--light'],\n};\n\nconst warn = warnOnce('Gallery');\n\nexport const CarouselBase = ({\n  bullets = false,\n  getRootRef,\n  children,\n  slideWidth = '100%',\n  slideIndex = 0,\n  isDraggable: isDraggableProp = true,\n  onDragStart,\n  onDragEnd,\n  onChange,\n  onPrevClick,\n  onNextClick,\n  align = 'left',\n  showArrows,\n  getRef,\n  arrowSize = 'l',\n  ...restProps\n}: BaseGalleryProps) => {\n  const slidesStore = React.useRef<Record<string, HTMLDivElement | null>>({});\n  const slidesManager = React.useRef<SlidesManagerState>(SLIDES_MANAGER_STATE);\n\n  const rootRef = useExternRef(getRootRef);\n  const viewportRef = useExternRef(getRef);\n  const layerRef = React.useRef<HTMLDivElement>(null);\n  const animationFrameRef = React.useRef<ReturnType<typeof requestAnimationFrame> | null>(null);\n  const shiftXCurrentRef = React.useRef<number>(0);\n  const shiftXDeltaRef = React.useRef<number>(0);\n  const initialized = React.useRef<boolean>(false);\n  const { addToAnimationQueue, getAnimateFunction, startAnimation } = useSlideAnimation();\n\n  const [controlElementsState, setControlElementsState] =\n    React.useState<ControlElementsState>(CONTROL_ELEMENTS_STATE);\n\n  const { window } = useDOM();\n  const hasPointer = useAdaptivityHasPointer();\n\n  const isCenterWithCustomWidth = slideWidth === 'custom' && align === 'center';\n\n  const transformCssStyles = (shiftX: number, animation = false) => {\n    slidesManager.current.loopPoints.forEach((loopPoint) => {\n      const { target, index } = loopPoint;\n      const slide = slidesStore.current[index];\n      if (slide) {\n        slide.style.transform = `translate3d(${target(shiftX)}px, 0, 0)`;\n      }\n    });\n\n    if (layerRef.current) {\n      layerRef.current.style.transform = `translate3d(${shiftX}px, 0, 0)`;\n      layerRef.current.style.transition = animation\n        ? `transform ${ANIMATION_DURATION}ms cubic-bezier(.1, 0, .25, 1)`\n        : '';\n    }\n  };\n\n  const requestTransform = (shiftX: number, animation = false) => {\n    const { snaps, contentSize, slides } = slidesManager.current;\n\n    if (animationFrameRef.current !== null) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    animationFrameRef.current = requestAnimationFrame(() => {\n      if (shiftX > snaps[0]) {\n        shiftXCurrentRef.current = -contentSize + snaps[0];\n        shiftX = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      }\n      const lastPoint = slides[slides.length - 1].width + slides[slides.length - 1].coordX;\n\n      if (shiftX <= -lastPoint) {\n        shiftXCurrentRef.current = Math.abs(shiftXDeltaRef.current) + snaps[0];\n      }\n      transformCssStyles(shiftX, animation);\n    });\n  };\n\n  const initializeSlides = () => {\n    if (!rootRef.current || !viewportRef.current) {\n      return;\n    }\n    let localSlides =\n      React.Children.map(children, (_item, i): GallerySlidesState => {\n        const elem = slidesStore.current[i] || { offsetLeft: 0, offsetWidth: 0 };\n        return { coordX: elem.offsetLeft, width: elem.offsetWidth };\n      }) || [];\n\n    const containerWidth = rootRef.current.offsetWidth;\n    const viewportOffsetWidth = viewportRef.current.offsetWidth;\n    const layerWidth = localSlides.reduce((val, slide) => slide.width + val, 0);\n\n    if (process.env.NODE_ENV === 'development') {\n      let remainingWidth = containerWidth;\n      let slideIndex = 0;\n\n      while (remainingWidth > 0 && slideIndex < localSlides.length) {\n        remainingWidth -= localSlides[slideIndex].width;\n        slideIndex++;\n      }\n      if (remainingWidth <= 0 && slideIndex === localSlides.length) {\n        warn(\n          'Ширины слайдов недостаточно для корректной работы свойства \"looped\". Пожалуйста, сделайте её больше.\"',\n        );\n      }\n    }\n    if (align === 'center') {\n      const firstSlideShift = (containerWidth - localSlides[0].width) / 2;\n      localSlides = localSlides.map((item) => {\n        return {\n          width: item.width,\n          coordX: item.coordX - firstSlideShift,\n        };\n      });\n    }\n\n    slidesManager.current = {\n      ...slidesManager.current,\n      viewportOffsetWidth,\n      slides: localSlides,\n      isFullyVisible: layerWidth <= containerWidth,\n    };\n\n    const snaps = localSlides.map((_, index) =>\n      calculateIndent(index, slidesManager.current, isCenterWithCustomWidth),\n    );\n\n    let contentSize = -snaps[snaps.length - 1] + localSlides[localSlides.length - 1].width;\n    if (align === 'center') {\n      contentSize += snaps[0];\n    }\n\n    slidesManager.current.snaps = snaps;\n    slidesManager.current.contentSize = contentSize;\n    slidesManager.current.loopPoints = getLoopPoints(slidesManager.current, containerWidth);\n\n    setControlElementsState({\n      canSlideLeft: !slidesManager.current.isFullyVisible,\n      canSlideRight: !slidesManager.current.isFullyVisible,\n      isDraggable: isDraggableProp && !slidesManager.current.isFullyVisible,\n    });\n\n    shiftXCurrentRef.current = snaps[slideIndex];\n    initialized.current = true;\n\n    requestTransform(shiftXCurrentRef.current);\n  };\n\n  const onResize = () => {\n    if (initialized.current) {\n      initializeSlides();\n    }\n  };\n\n  useGlobalEventListener(window, 'resize', onResize);\n\n  useIsomorphicLayoutEffect(\n    function performSlideChange() {\n      if (!initialized.current) {\n        return;\n      }\n      const { snaps, slides } = slidesManager.current;\n      const indent = snaps[slideIndex];\n      let startPoint = shiftXCurrentRef.current;\n\n      /**\n       * Переключаемся с последнего элемента на первый\n       * Для корректной анимации мы прокручиваем последний слайд на всю длину (shiftX) \"вперед\"\n       * В конце анимации при отрисовке следующего кадра задаем всем слайдам начальные значения\n       */\n      if (indent === snaps[0] && shiftXCurrentRef.current <= snaps[snaps.length - 1]) {\n        const distance =\n          Math.abs(snaps[snaps.length - 1]) + slides[slides.length - 1].width + startPoint;\n\n        addToAnimationQueue(\n          getAnimateFunction((progress) => {\n            const shiftX = startPoint + progress * distance * -1;\n\n            transformCssStyles(shiftX);\n\n            if (shiftX <= snaps[snaps.length - 1] - slides[slides.length - 1].width) {\n              requestAnimationFrame(() => {\n                shiftXCurrentRef.current = indent;\n                transformCssStyles(snaps[0]);\n              });\n            }\n          }),\n        );\n        /**\n         * Переключаемся с первого слайда на последний\n         * Для корректной анимации сначала задаем первым видимым слайдам смещение\n         * В следующем кадре начинаем анимация прокрутки \"назад\"\n         */\n      } else if (indent === snaps[snaps.length - 1] && shiftXCurrentRef.current === snaps[0]) {\n        startPoint = indent - slides[slides.length - 1].width;\n\n        addToAnimationQueue(() => {\n          requestAnimationFrame(() => {\n            const shiftX = indent - slides[slides.length - 1].width;\n            transformCssStyles(shiftX);\n\n            getAnimateFunction((progress) => {\n              transformCssStyles(startPoint + progress * slides[slides.length - 1].width);\n            })();\n          });\n        });\n        /**\n         * Если не обработаны `corner`-кейсы выше, то просто проигрываем анимацию смещения\n         */\n      } else {\n        addToAnimationQueue(() => {\n          const distance = Math.abs(indent - startPoint);\n          let direction = startPoint <= indent ? 1 : -1;\n\n          getAnimateFunction((progress) => {\n            const shiftX = startPoint + progress * distance * direction;\n            transformCssStyles(shiftX);\n          })();\n        });\n      }\n\n      startAnimation();\n\n      shiftXCurrentRef.current = indent;\n    },\n    [slideIndex],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    initializeSlides();\n  }, [children, align, slideWidth]);\n\n  const slideLeft = (event: React.MouseEvent) => {\n    onChange?.(\n      (slideIndex - 1 + slidesManager.current.slides.length) % slidesManager.current.slides.length,\n    );\n    onPrevClick?.(event);\n  };\n\n  const slideRight = (event: React.MouseEvent) => {\n    onChange?.((slideIndex + 1) % slidesManager.current.slides.length);\n    onNextClick?.(event);\n  };\n\n  const onStart = (e: TouchEvent) => {\n    e.originalEvent.stopPropagation();\n    onDragStart?.(e);\n    shiftXCurrentRef.current = slidesManager.current.snaps[slideIndex];\n    shiftXDeltaRef.current = 0;\n  };\n\n  const onMoveX = (e: TouchEvent) => {\n    if (isDraggableProp && !slidesManager.current.isFullyVisible) {\n      e.originalEvent.preventDefault();\n\n      if (e.isSlideX) {\n        if (shiftXDeltaRef.current !== e.shiftX) {\n          shiftXDeltaRef.current = e.shiftX;\n          requestTransform(shiftXCurrentRef.current + shiftXDeltaRef.current);\n        }\n      }\n    }\n  };\n\n  const onEnd = (e: TouchEvent) => {\n    let targetIndex = slideIndex;\n    if (e.isSlide) {\n      targetIndex = getTargetIndex(\n        slidesManager.current.slides,\n        slideIndex,\n        shiftXCurrentRef.current,\n        shiftXDeltaRef.current,\n      );\n    }\n    onDragEnd?.(e, targetIndex);\n\n    if (targetIndex !== slideIndex) {\n      shiftXCurrentRef.current = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      onChange?.(targetIndex);\n    } else {\n      const initialShiftX = slidesManager.current.snaps[targetIndex];\n      requestTransform(initialShiftX, true);\n    }\n  };\n\n  const setSlideRef = (slideRef: HTMLDivElement | null, slideIndex: number) => {\n    slidesStore.current[slideIndex] = slideRef;\n  };\n\n  const { canSlideLeft, canSlideRight, isDraggable } = controlElementsState;\n\n  return (\n    <RootComponent\n      {...restProps}\n      baseClassName={classNames(\n        styles['BaseGallery'],\n        slideWidth === 'custom' && styles['BaseGallery--custom-width'],\n        isDraggable && styles['BaseGallery--draggable'],\n      )}\n      getRootRef={rootRef}\n    >\n      <Touch\n        className={styles['BaseGallery__viewport']}\n        onStartX={onStart}\n        onMoveX={onMoveX}\n        onEnd={onEnd}\n        style={{ width: slideWidth === 'custom' ? '100%' : slideWidth }}\n        getRootRef={viewportRef}\n        noSlideClick\n      >\n        <div className={styles['BaseGallery__layer']} ref={layerRef}>\n          {React.Children.map(children, (item: React.ReactNode, i: number) => (\n            <div\n              className={styles['BaseGallery__slide']}\n              key={`slide-${i}`}\n              ref={(el) => setSlideRef(el, i)}\n            >\n              {item}\n            </div>\n          ))}\n        </div>\n      </Touch>\n\n      {bullets && (\n        <div\n          aria-hidden\n          className={classNames(styles['BaseGallery__bullets'], stylesBullets[bullets])}\n        >\n          {React.Children.map(children, (_item: React.ReactNode, index: number) => (\n            <div\n              className={classNames(\n                styles['BaseGallery__bullet'],\n                index === slideIndex && styles['BaseGallery__bullet--active'],\n              )}\n              key={index}\n            />\n          ))}\n        </div>\n      )}\n\n      {showArrows && hasPointer && canSlideLeft && (\n        <ScrollArrow\n          className={styles['BaseGallery__arrow']}\n          direction=\"left\"\n          onClick={slideLeft}\n          size={arrowSize}\n        />\n      )}\n      {showArrows && hasPointer && canSlideRight && (\n        <ScrollArrow\n          className={styles['BaseGallery__arrow']}\n          direction=\"right\"\n          onClick={slideRight}\n          size={arrowSize}\n        />\n      )}\n    </RootComponent>\n  );\n};\n"],"names":["React","classNames","useAdaptivityHasPointer","useExternRef","useGlobalEventListener","useDOM","useIsomorphicLayoutEffect","warnOnce","RootComponent","ScrollArrow","Touch","ANIMATION_DURATION","CONTROL_ELEMENTS_STATE","SLIDES_MANAGER_STATE","calculateIndent","getLoopPoints","getTargetIndex","useSlideAnimation","styles","stylesBullets","dark","light","warn","CarouselBase","bullets","getRootRef","children","slideWidth","slideIndex","isDraggable","isDraggableProp","onDragStart","onDragEnd","onChange","onPrevClick","onNextClick","align","showArrows","getRef","arrowSize","restProps","slidesStore","useRef","slidesManager","rootRef","viewportRef","layerRef","animationFrameRef","shiftXCurrentRef","shiftXDeltaRef","initialized","addToAnimationQueue","getAnimateFunction","startAnimation","controlElementsState","setControlElementsState","useState","window","hasPointer","isCenterWithCustomWidth","transformCssStyles","shiftX","animation","current","loopPoints","forEach","loopPoint","target","index","slide","style","transform","transition","requestTransform","snaps","contentSize","slides","cancelAnimationFrame","requestAnimationFrame","lastPoint","length","width","coordX","Math","abs","initializeSlides","localSlides","Children","map","_item","i","elem","offsetLeft","offsetWidth","containerWidth","viewportOffsetWidth","layerWidth","reduce","val","process","env","NODE_ENV","remainingWidth","firstSlideShift","item","isFullyVisible","_","canSlideLeft","canSlideRight","onResize","performSlideChange","indent","startPoint","distance","progress","direction","slideLeft","event","slideRight","onStart","e","originalEvent","stopPropagation","onMoveX","preventDefault","isSlideX","onEnd","targetIndex","isSlide","initialShiftX","setSlideRef","slideRef","baseClassName","className","onStartX","noSlideClick","div","ref","key","el","aria-hidden","onClick","size"],"mappings":"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"}