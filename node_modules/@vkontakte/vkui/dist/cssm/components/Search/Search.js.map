{"version":3,"sources":["../../../../src/components/Search/Search.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Icon16Clear, Icon16SearchOutline, Icon24Cancel } from '@vkontakte/icons';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useAdaptivityConditionalRender } from '../../hooks/useAdaptivityConditionalRender';\nimport { useBooleanState } from '../../hooks/useBooleanState';\nimport { useEnsuredControl } from '../../hooks/useEnsuredControl';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useId } from '../../hooks/useId';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { SizeType } from '../../lib/adaptivity';\nimport { Platform } from '../../lib/platform';\nimport { touchEnabled, VKUITouchEvent } from '../../lib/touch';\nimport { HasRef, HasRootRef } from '../../types';\nimport { Button } from '../Button/Button';\nimport { IconButton } from '../IconButton/IconButton';\nimport { TouchEvent } from '../Touch/Touch';\nimport { Headline } from '../Typography/Headline/Headline';\nimport styles from './Search.module.css';\n\nexport interface SearchProps\n  extends React.InputHTMLAttributes<HTMLInputElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLInputElement> {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: React.ReactNode;\n  before?: React.ReactNode;\n  icon?: React.ReactNode;\n  onIconClick?(e: VKUITouchEvent): void;\n  defaultValue?: string;\n  iconAriaLabel?: string;\n  clearAriaLabel?: string;\n  /**\n   * Удаляет отступы у компонента\n   */\n  noPadding?: boolean;\n  /**\n   * Текст для кнопки Найти\n   */\n  findButtonText?: string;\n  /**\n   * Коллбэк для кнопки Найти\n   */\n  onFindButtonClick?: React.MouseEventHandler<HTMLElement>;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Search\n */\nexport const Search = ({\n  id: idProp,\n  before = <Icon16SearchOutline />,\n  className,\n  defaultValue = '',\n  placeholder = 'Поиск',\n  after = 'Отмена',\n  getRef,\n  icon,\n  onIconClick = noop,\n  style,\n  autoComplete = 'off',\n  onChange: onChangeProp,\n  value: valueProp,\n  iconAriaLabel,\n  clearAriaLabel = 'Очистить',\n  noPadding,\n  getRootRef,\n  findButtonText = 'Найти',\n  onFindButtonClick,\n  ...inputProps\n}: SearchProps) => {\n  const inputRef = useExternRef(getRef);\n  const {\n    value: isFocused,\n    setTrue: setFocusedTrue,\n    setFalse: setFocusedFalse,\n  } = useBooleanState(false);\n  const generatedId = useId();\n  const inputId = idProp ? idProp : `search-${generatedId}`;\n\n  const [value, onChange] = useEnsuredControl({\n    defaultValue,\n    onChange: onChangeProp,\n    value: valueProp,\n  });\n  const { sizeY = 'none' } = useAdaptivity();\n  const { sizeY: adaptiveSizeY } = useAdaptivityConditionalRender();\n  const platform = usePlatform();\n\n  const onFocus = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocusedTrue();\n    inputProps.onFocus && inputProps.onFocus(e);\n  };\n\n  const onBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocusedFalse();\n    inputProps.onBlur && inputProps.onBlur(e);\n  };\n\n  const onCancel = React.useCallback(() => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(\n      HTMLInputElement.prototype,\n      'value',\n    )?.set;\n    nativeInputValueSetter?.call(inputRef.current, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    inputRef.current?.dispatchEvent(ev2);\n  }, [inputRef]);\n\n  const onIconClickStart = React.useCallback(\n    (e: TouchEvent) => onIconClick(e.originalEvent),\n    [onIconClick],\n  );\n\n  const onIconCancelClickStart = React.useCallback(\n    (e: TouchEvent) => {\n      e.originalEvent.preventDefault();\n      inputRef.current?.focus();\n      if (touchEnabled()) {\n        onCancel();\n      }\n    },\n    [inputRef, onCancel],\n  );\n\n  return (\n    <div\n      className={classNames(\n        'vkuiInternalSearch',\n        styles['Search'],\n        sizeY === 'none' && styles['Search--sizeY-none'],\n        sizeY === SizeType.COMPACT && styles['Search--sizeY-compact'],\n        isFocused && styles['Search--focused'],\n        value && styles['Search--has-value'],\n        after && styles['Search--has-after'],\n        icon && styles['Search--has-icon'],\n        inputProps.disabled && styles['Search--disabled'],\n        !noPadding && styles['Search--withPadding'],\n        className,\n      )}\n      ref={getRootRef}\n      style={style}\n    >\n      <div className={styles['Search__field']}>\n        <label htmlFor={inputId} className={styles['Search__label']}>\n          {placeholder}\n        </label>\n        <div className={styles['Search__input']}>\n          {before}\n          <Headline\n            Component=\"input\"\n            type=\"search\"\n            level=\"1\"\n            weight=\"3\"\n            {...inputProps}\n            id={inputId}\n            placeholder={placeholder}\n            autoComplete={autoComplete}\n            getRootRef={inputRef}\n            className={styles['Search__nativeInput']}\n            onFocus={onFocus}\n            onBlur={onBlur}\n            onChange={onChange}\n            value={value}\n          />\n        </div>\n        <div className={styles['Search__controls']}>\n          {icon && (\n            <IconButton\n              hoverMode=\"opacity\"\n              onStart={onIconClickStart}\n              className={styles['Search__icon']}\n              onFocus={setFocusedTrue}\n              onBlur={setFocusedFalse}\n              aria-label={iconAriaLabel}\n            >\n              {icon}\n            </IconButton>\n          )}\n          <IconButton\n            hoverMode=\"opacity\"\n            onStart={onIconCancelClickStart}\n            onClick={onCancel}\n            className={styles['Search__icon']}\n            aria-label={clearAriaLabel}\n            tabIndex={value ? undefined : -1}\n          >\n            {platform === Platform.IOS ? <Icon16Clear /> : <Icon24Cancel />}\n          </IconButton>\n          {adaptiveSizeY.compact && onFindButtonClick && (\n            <Button\n              mode=\"primary\"\n              size=\"m\"\n              className={classNames(styles['Search__findButton'], adaptiveSizeY.compact.className)}\n              focusVisibleMode=\"inside\"\n              onClick={onFindButtonClick}\n              tabIndex={value ? undefined : -1}\n            >\n              {findButtonText}\n            </Button>\n          )}\n        </div>\n      </div>\n      {platform === Platform.IOS && after && (\n        <Button\n          mode=\"tertiary\"\n          size=\"m\"\n          className={styles['Search__after']}\n          focusVisibleMode=\"inside\"\n          onClick={onCancel}\n          onFocus={setFocusedTrue}\n          onBlur={setFocusedFalse}\n        >\n          <span className={styles['Search__afterText']}>{after}</span>\n        </Button>\n      )}\n    </div>\n  );\n};\n"],"names":["React","Icon16Clear","Icon16SearchOutline","Icon24Cancel","classNames","noop","useAdaptivity","useAdaptivityConditionalRender","useBooleanState","useEnsuredControl","useExternRef","useId","usePlatform","SizeType","Platform","touchEnabled","Button","IconButton","Headline","styles","Search","id","idProp","before","className","defaultValue","placeholder","after","getRef","icon","onIconClick","style","autoComplete","onChange","onChangeProp","value","valueProp","iconAriaLabel","clearAriaLabel","noPadding","getRootRef","findButtonText","onFindButtonClick","inputProps","inputRef","isFocused","setTrue","setFocusedTrue","setFalse","setFocusedFalse","generatedId","inputId","sizeY","adaptiveSizeY","platform","onFocus","e","onBlur","onCancel","useCallback","nativeInputValueSetter","Object","getOwnPropertyDescriptor","HTMLInputElement","prototype","set","call","current","ev2","Event","bubbles","dispatchEvent","onIconClickStart","originalEvent","onIconCancelClickStart","preventDefault","focus","div","COMPACT","disabled","ref","label","htmlFor","Component","type","level","weight","hoverMode","onStart","aria-label","onClick","tabIndex","undefined","IOS","compact","mode","size","focusVisibleMode","span"],"mappings":"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"}